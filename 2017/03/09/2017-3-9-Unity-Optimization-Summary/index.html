<!DOCTYPE html><meta name="viewport" content="height=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="cwhisme"><meta name="author" content="CWHISME"><meta property="og:title" content="Unity3D性能优化总结"><meta property="og:description" content="cwhisme"><meta property="og:site_name" content="WangJiaYing"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>Unity3D性能优化总结 - WangJiaYing</title><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/DateTimeAfeterCalc.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/particles-bg.js"></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/script.js"></script><link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/css/style.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="WangJiaYing" type="application/atom+xml">
</head><body><canvas id="hackEffectCanvas" style="position:fixed;z-index:-1;pointer-events:none"></canvas><canvas class="fireworks" style="position:fixed;z-index:10;pointer-events:none"></canvas><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="WangJiaYing"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/logo.svg" class="dib h3" alt="WangJiaYing"></a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">Tags </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/categories" title="Categories">Categories </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/bookmark" title="Bookmark">Bookmark </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about" title="About">About</a></div></nav><div class="w-100 mw8 center vh-40 dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">Unity3D性能优化总结</h1><p class="f4 fw3 pab-100px tc tc-m tl-ns"><i class="fa fa-calendar-check-o" aria-hidden="true"></i> 2017-03-09&nbsp&nbsp <i class="fa fa-clock-o" aria-hidden="true"></i> <span id="dateTimeAfter">2017-03-09</span></p></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-star-half-o"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><div class="tags-container-vertical"><div class="tags-sub-container"><a class="fw3 ph1 dib" href="/tags/性能优化/">#性能优化</a></div></div><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>关于Unity3D中的各种优化方式，相信早已是个老生常谈的问题了，不少人都开过坑。<br>为了避免让人觉得不开坑的话，就好像不知道这些优化措施一样，索性我也来这么一次。</p><p>说到对游戏的优化，有过相关了解的人，首先应该知道公认的主要有三个方面：CPU、GPU、内存相关优化。<br>这三个方面，也即是关乎整个游戏运行效率的三个“根”节点。</p><p>好了，那么下面有请在无数示例中都有所贡献的 “Window 绘图工具”——我很想这样说，不过由于最后画出来发现因为太复杂，导致很难看，所以决定直接用文字排版算了(我会注意按照相应顺序进行排版的)。</p><h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><h3 id="CPU优化"><a href="#CPU优化" class="headerlink" title="CPU优化"></a>CPU优化</h3><p>1.DrawCall</p><ul><li><p>Dynamic Batching<br>动态批处理，所有操作都已经由引擎自动完成了，不需要我们做任何事儿。<br>需要注意的只有“是否满足要求”：</p><ul><li>Mesh顶点小于900(若Shader使用过Normnal、UV、Position等，顶点支持小于300)</li><li>材质不同，不支持</li><li>拥有lightmap的物件不能批处理</li><li>多通道的Shader会妨碍批处理操作，接受实时阴影的物件无法批处理</li><li>满足上诉条件，但是缩放不同也不能支持<br>所以都说，动态批处理限制很多，最好用静态批处理。</li></ul></li><li><p>Static Batching<br>静态批处理，相比动态批处理来说，限制更小(缩放、顶点等没啥影响)。在不需要移动的物体上勾选Static即可。当勾选Static之后，在场景时就会将其合并至“Combined Mesh”中，相当于该GameObject已经失去了“自我”，所以也无法再行移动。<br>如图：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2017.3.9-1.png" alt="Static Batching"><br>这种方式可以将使用了相同材质的任意大小物体进行合并，以减少Drawcall。<br>PS：材质不同DrawCall是降低不了的，这点类似动态批处理，所以不要以为勾选了Static就完事儿了！因此再分细一点的话，还需将各个GameObject使用的小的贴图合并成大的图集，并采用相同材质进行优化。<br>另外，再来一点：对于StaticBatching还可以使用代码<code>StaticBatchingUtility.Combine()</code>进行StaticBatching处理。</p></li><li><p>遮挡剔除<br>Unity自带了Occlusion Culling烘培工具，可进行遮挡剔除的烘培处理。</p></li><li><p>视椎体剔除<br>可以通过调整相机的Near、Far剪裁平面距离进行一定优化。</p></li><li><p>摄像机分层距离剔除(Per-Layer Cull Distances)<br>关于这个，可以在主相机<code>Camera.main.layerCullDistances</code>进行设置。</p></li><li><p>光照<br>实时光照+阴影会极大地增加Drawcall，因为带有光源计算的Shader因为使用额外Pass计算阴影造成Drawcall增加。 一般情况下，最好使用烘焙光照贴图+LightProp等优化。<br>(PS:实时光照阴影真的很耗，没昼夜切换的要求就算了吧，就算有，若没有实时光照改变的需求，也可以通过烘培多张LightMap来Trick。)</p></li><li><p>骨骼</p></li><li><p>没有动画的物体，在导入时务必确保删除了动画组件(有时候模型没动画也会自动被添加)</p></li></ul><p>2.物理</p><ul><li>碰撞器<br>各个碰撞器性能(由小至大)：<br>SphereCollider-&gt;CapsuleCollider-&gt;BoxCollider-&gt;MeshCollider<br>其中MeshCollider完全是“能不用就千万别用”的典范。<br>平时可以根据上面排行，进行选择吧。</li><li>物理查询<br>尽量少用，并且不要每帧查询。(比如检测地面之类的)</li></ul><p>3.GC</p><p>GC是.Net的垃圾回收机制，虽然主要是处理内存，但是在进行内存回收的时候，会极大地增加CPU的负担，所以…也是需要注意的一点，尽量少触发GC。<br>比如：</p><ul><li>链接字符串</li><li>使用For代替Foreach</li><li>减少创建新对象的频率，如使用对象池技术</li><li>能使用Struct的时候就不要用Class</li><li>等…</li></ul><p>4.代码<br>代码优化涉及到的东西就多了，而且相信各有各的经验，就不多提了。<br>(其中部分内容可参考下文的“代码内存”优化)</p><h3 id="GPU优化"><a href="#GPU优化" class="headerlink" title="GPU优化"></a>GPU优化</h3><p>对于GPU方面的优化，主要有下面几个：</p><ul><li><p>顶点数量</p><ul><li>让美术优化模型(比如使用法线、视差贴图代替高模渲染)</li><li>使用LOD</li><li>若模型并未使用法线贴图，可以在导入的时候关闭Normals&amp;Tangents导入。</li><li>遮挡剔除(上面CPU优化也有提到)</li><li>视椎体剔除(上面CPU优化也有提到)</li><li>摄像机分层距离剔除(Per-Layer Cull Distances)(上面CPU优化也有提到)</li></ul></li><li><p>像素填充率</p><ul><li>尽量少使用透明物体<br>为什么呢？据说是因为现代显卡大多采用了Early-Z技术，进行透明物体处理将会与其发生冲突，导致更多的像素需要被处理。</li><li>实时光与阴影</li></ul></li><li><p>显存带宽</p><ul><li>压缩纹理贴图</li><li>使用Mipmap<br>Mipmap可根据需要，向GPU发送更小细节的图片进行渲染。</li></ul></li><li><p>Shader</p><ul><li>可以的情况下，尽量使用Fixed、Half代替Float进行计算。</li><li>在Shader的Fragment中进行更少的计算，可能的话，移至Vertex程序中计算，并由GPU插值。</li><li>尽量不使用If语句</li><li>手机游戏就不要使用Standard Shader了，若有需要，可以使用Mobile Shader或者自己写个V&amp;F Shader。(Mobile Shader使用的是Surface Shader，多了很多冗余代码)</li></ul></li></ul><h3 id="内存优化"><a href="#内存优化" class="headerlink" title="内存优化"></a>内存优化</h3><ul><li>代码内存(.Net托管内存)<ul><li>链接大量字符串使用StringBuilder</li><li>For代替Foreach</li><li>使用Struct(值类型)代替Class(引用类型)，另外，若使用Struct，一般可配合Ref关键字避免大量拷贝。</li><li>减少局部变量(或使用成员变量代替)</li><li>使用对象池技术，减少创建新对象的频率</li><li>等(待补充…)</li></ul></li><li>Unity内存<ul><li>对动态加载的资源(Resources.load或者AssetBundle)使用完毕后，使用相应接口进行释放。<br>(Resources.UnloadUnusedAssets()、assetBundle.Unload(false))</li><li>纹理压缩</li><li>图集</li><li>等(待补充…)</li></ul></li></ul><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>目前总结如此，简单罗列了下自己所了解到的内容，后续会根据我自己的了解，进行对应的补充。</p><p>以上。</p><div class="tags-container-bottom"><i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/性能优化/">#性能优化</a></div><br><br><hr><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><div id="vcomments"></div><script>new Valine({el:"#vcomments",appId:"MsaVbSzIr9cIfikihDExdun9-gzGzoHsz",appKey:"Bj6SEFUBomrLOTWx9B8S6zQH",placeholder:"请输入评论内容~",avatar:"mp",visitor:!1})</script></div><div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50"><hr class="dn-l mw4 black-50 mt5"><div class="mt5 mt0-l site-author"><article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3"><div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width:6rem"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/photo.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="CWHISME"></div><div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">悲观主义的末日</div></article></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>分类</h3><p><a href="/categories/Unity3D/">Unity3D</a></p></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>近期文章</h3><p><a href="/2022/12/10/%E5%8D%8F%E5%8F%98%E5%92%8C%E9%80%86%E5%8F%98/">协变和逆变</a></p><p><a href="/2022/12/06/Unity%E7%9A%84%E9%98%B4%E5%BD%B1%E4%B8%8E%E5%85%89%E7%85%A7%E7%83%98%E7%84%99/">Unity 的阴影与光照烘焙</a></p><p><a href="/2022/11/23/%E6%89%93%E5%8C%85AssetBundle%E5%9F%BA%E7%A1%80%E8%A7%84%E5%88%99%E6%95%B4%E7%90%86/">打包 AssetBundle 的基础规则整理</a></p><p><a href="/2022/11/18/StringBuilder%E6%89%A9%E5%AE%B9%E8%A7%84%E5%88%99%E7%A0%94%E7%A9%B6/">StringBuilder 扩容规则研究</a></p><p><a href="/2022/11/17/%E6%B5%8B%E8%AF%95%E6%89%8B%E5%8A%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">简单测试手动垃圾回收</a></p></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://github.com/CWHISME" target="_blank"><i class="fa fa-github"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="mailto:cwhisme@126.com" target="_blank"><i class="fa fa-envelope"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div></div><div class="f6 f5-ns center tc white pt5 fw3">Copyright © 2021 | Design & Hexo <a class="link dim white" target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-anodyne/">Jonathan Klughertz</a> | Modify By CWHISME</div></div></div></body></html>