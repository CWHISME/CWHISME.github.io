<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="CWHISME" href="https://wangjiaying.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="CWHISME" href="https://wangjiaying.top/atom.xml"><link rel="alternate" type="application/json" title="CWHISME" href="https://wangjiaying.top/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Avalonia"><link rel="canonical" href="https://wangjiaying.top/2024/10/20/UiharuMind%E5%9B%BD%E5%BA%86%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"><title>UiharuMind 国庆开发笔记 - Avalonia | Jiaying's Note = CWHISME = 人不能没有梦想，也要有足够的敬畏</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">UiharuMind 国庆开发笔记</h1><div class="meta"><span class="item" title="创建时间：2024-10-20 19:24:47"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-10-20T19:24:47+08:00">2024-10-20</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>7.3k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>7 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Jiaying's Note</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="/images/coverimages/large/106709906_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/84910372_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/9bd9b167gy1fwrt7jxktnj21hc0u0dum.webp"></li><li class="item" data-background-image="/images/coverimages/large/5e48a8ffd2353abeb139ffe48fa7b04bdc301799_raw.webp"></li><li class="item" data-background-image="/images/coverimages/large/104001022_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/0072Vf1pgy1foxkfg4cj2j31hc0u01a9.webp"></li></ul></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Avalonia/" itemprop="item" rel="index" title="分类于 Avalonia"><span itemprop="name">Avalonia</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://wangjiaying.top/2024/10/20/UiharuMind%E5%9B%BD%E5%BA%86%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/../img/avator"><meta itemprop="name" content="WangJiaYing"><meta itemprop="description" content="人不能没有梦想，也要有足够的敬畏, 己所不欲，勿施于人"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CWHISME"></span><div class="body md" itemprop="articleBody"><h1 id="2024年10月1日"><a class="anchor" href="#2024年10月1日">#</a> 2024 年 10 月 1 日</h1><p>接入实际的 llamacpp 根据配置的调用使用，重构了一波异步计算信息，将简单的快捷解释界面基本弄好了</p><h1 id="2024年10月2日"><a class="anchor" href="#2024年10月2日">#</a> 2024 年 10 月 2 日</h1><p>今天主要是优化了各个界面排版，特别是聊天界面整体都重构了下。</p><p>还有之前感觉在 UI 涉及数据更新的时候卡顿问题，最后加了更新延迟：特别是 LLM 流式传输，打字机效果一样显示的情况，调整了 UI 更新频率感觉好些了。</p><h1 id="2024年10月3日"><a class="anchor" href="#2024年10月3日">#</a> 2024 年 10 月 3 日</h1><p>搞了一天加 Markdown 渲染效果，开始以为很简单，头一天晚上都想好了：</p><ul><li>先用 Markdig 配合 Markdown.ColorCode.CSharpToColoredHtml 渲染成 HTML</li><li>然后使用 Avalonia.HtmlRenderer 渲染显示</li></ul><p>怎么样？想着是不是很简单呢？</p><p>结果... 先是发现显示很有问题：Avalonia.HtmlRenderer 显示起来，感觉很怪，跟现在的主题完全对不上号。其次渲染感觉也有问题。其次流式更新性能也很糟糕....</p><p>然后中途就查另外一个 Avalonia.Markdown，换成这个也有不少坑，比如代码高亮都没有，最后到处查，查 issue，结果最后在它自己的 wiki... 最后一篇才写着：代码用的 TextEditor，得 Fluent 主题才支持！</p><p>于是又研究来研究去的... 最后得出结论：</p><ul><li>可以给 MarkdownScrollViewer 指定 FluentTheme，然后内联指定 SimpleTheme 配合 avares://AvaloniaEdit/Themes/Simple/AvaloniaEdit.xaml 勉强正常显示</li><li>之所以说勉强，是因为有些显示不对：文字选择、代码高亮都没有了</li><li>代码高亮可以强行指定语言，比如 C#，不过其它的，纯文字看着还行，手动选择一下就不对劲了，而且有时候生成的代码是纯粹的 TextBlock 模式，选也没法选</li></ul><p>设置代码如下：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mdxaml:</span>MarkdownScrollViewer</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token attr-name">Name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>MarkdownScrollViewer<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token attr-name">MarkdownStyleName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>FluentTheme<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token attr-name">SelectionEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mdxaml:</span>MarkdownScrollViewer.Plugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mdxaml:</span>MdAvPlugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">avalonia:</span>ChatAISetup</span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mdxaml:</span>MdAvPlugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mdxaml:</span>MarkdownScrollViewer.Plugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">mdxaml:</span>MarkdownScrollViewer.Styles</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">&lt;!-- &lt;FluentTheme /> --></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">&lt;!-- &lt;StyleInclude Source="avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml" /> --></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SimpleTheme</span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>StyleInclude</span> <span class="token attr-name">Source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avares://AvaloniaEdit/Themes/Simple/AvaloniaEdit.xaml<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name">Selector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Button.CopyButton TextBlock<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="16"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Setter</span> <span class="token attr-name">Property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Text<span class="token punctuation">"</span></span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>📋<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name">Selector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.CodeBlock avedit|TextEditor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Setter</span> <span class="token attr-name">Property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ShowLineNumbers<span class="token punctuation">"</span></span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token comment">&lt;!-- 强行写死 C#，因为目前 MarkdownScrollViewer 有问题，使用 FluentTheme 代码高亮是有了，但是内容会丢失，而且闪烁 --></span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Setter</span> <span class="token attr-name">Property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>SyntaxHighlighting<span class="token punctuation">"</span></span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>C#<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mdxaml:</span>MarkdownScrollViewer.Styles</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">mdxaml:</span>MarkdownScrollViewer</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>太晚了，最后无奈先用着这一版，后面再看吧。</p><h1 id="2024年10月4日"><a class="anchor" href="#2024年10月4日">#</a> 2024 年 10 月 4 日</h1><p>昨天晚上也是，睡不着觉，今天早上 5 点多就醒了，翻来覆去到 8 点，然后开始搞。</p><p>本来计划把突然想到的剪切板历史记录给搞出来，而且以为会很快 —— 左右估计不过几个小时，结果调各种效果啥的，愣是又花了一天，今天已经时 4 号了，国庆竟然连 B 站都基本还没打开看过什么....</p><p>选择快八点了，刚炒了菜准备吃饭，于是想先记录一下。</p><p>最后效果这样：</p><p><img data-src="/blogimages/2024/2024-10-20/image1.png" alt=""></p><p>虽然也搞了些其它东西，比如又重构了下 SK 发送给 LLM 的方式。从下午开始搞的，但是搞这么久也真的是....</p><p>不行啊，国庆都连肝 4 天了，这可是一年才有一次的大假期！！！今天还计划把角色、工具人的设置及界面搞了，结果也没时间弄、还有优化流式显示，想着先纯文本流式打字机显示，完了再统一渲染成 Markdown，也是没时间搞了.... 我不想国庆都费再这.... 之前说的 UE5 教程也还没看...</p><h1 id="2024年10月5日"><a class="anchor" href="#2024年10月5日">#</a> 2024 年 10 月 5 日</h1><p>昨天晚上就发现 Avalonia.Markdown 渲染又出问题了，今天早上试了下，存在它的页面切换都要挂。</p><p>最后调到中午，发现还是绑出来的问题：</p><ul><li>我创建了一个 SimpleMarkdownViewer 封装这一系列设置，SimpleMarkdownViewer 本身挂了一些绑定属性：</li></ul><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">StyledProperty<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">></span></span> MarkdownTextProperty <span class="token operator">=</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    AvaloniaProperty<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SimpleMarkdownViewer<span class="token punctuation">,</span> <span class="token keyword">string</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>MarkdownText<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">StyledProperty<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">></span></span> IsPlaintextProperty <span class="token operator">=</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    AvaloniaProperty<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SimpleMarkdownViewer<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IsPlaintext<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> MarkdownText</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">get</span> <span class="token operator">=></span> <span class="token function">GetValue</span><span class="token punctuation">(</span>MarkdownTextProperty<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">set</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">// Log.Debug(_stopwatch.ElapsedMilliseconds + "       Setting Markdown to: ");</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token function">SetValue</span><span class="token punctuation">(</span>MarkdownTextProperty<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token comment">// _stopwatch.Restart();</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> HtmlText</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">get</span> <span class="token operator">=></span> MarkdownUtils<span class="token punctuation">.</span><span class="token function">ToHtml</span><span class="token punctuation">(</span>MarkdownText<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> IsPlaintext</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token keyword">get</span> <span class="token operator">=></span> <span class="token function">GetValue</span><span class="token punctuation">(</span>IsPlaintextProperty<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token keyword">set</span> <span class="token operator">=></span> <span class="token function">SetValue</span><span class="token punctuation">(</span>IsPlaintextProperty<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>在其它地方使用时，会直接绑定这些属性，然后在它的页面中，本身的 MarkdownScrollViewer 也会绑定它：</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!-- Avalonia.Markdown 渲染显示 --></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">avalonia:</span>MarkdownScrollViewer</span></span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token attr-name">IsVisible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;Binding !IsPlaintext, RelativeSource=&#123;RelativeSource AncestorType=&#123;x:Type common:SimpleMarkdownViewer&#125;&#125;&#125;<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token attr-name">SelectionEnabled</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token attr-name">Markdown</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>&#123;Binding MarkdownText, RelativeSource=&#123;RelativeSource AncestorType=&#123;x:Type common:SimpleMarkdownViewer&#125;&#125;&#125;<span class="token punctuation">"</span></span><span class="token punctuation">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">avalonia:</span>MarkdownScrollViewer.Plugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">avalonia:</span>MdAvPlugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">avalonia:</span>ChatAISetup</span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">avalonia:</span>MdAvPlugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">avalonia:</span>MarkdownScrollViewer.Plugins</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">avalonia:</span>MarkdownScrollViewer.Styles</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>FluentTheme</span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>StyleInclude</span> <span class="token attr-name">Source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>avares://AvaloniaEdit/Themes/Fluent/AvaloniaEdit.xaml<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment">&lt;!-- &lt;SimpleTheme /> --></span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">&lt;!-- &lt;StyleInclude Source="avares://AvaloniaEdit/Themes/Simple/AvaloniaEdit.xaml" /> --></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name">Selector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Button.CopyButton TextBlock<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Setter</span> <span class="token attr-name">Property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Text<span class="token punctuation">"</span></span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>📋<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Style</span> <span class="token attr-name">Selector</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>.CodeBlock avedit|TextEditor<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Setter</span> <span class="token attr-name">Property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ShowLineNumbers<span class="token punctuation">"</span></span> <span class="token attr-name">Value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>True<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token comment">&lt;!-- 强行写死 C#，因为目前 MarkdownScrollViewer 有问题，使用 FluentTheme 代码高亮是有了，但是内容会丢失，而且闪烁 --></span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token comment">&lt;!-- &lt;Setter Property="SyntaxHighlighting" Value="C#" /> --></span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Style</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">avalonia:</span>MarkdownScrollViewer.Styles</span><span class="token punctuation">></span></span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">avalonia:</span>MarkdownScrollViewer</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><p>结果不知道是不是这样中转导致渲染引擎出问题了，反正就是不报错，单纯就是切换页面的时候，整个页面卸载不掉，然后崩溃。</p><p>果然还是太好高骛远了，想着用方便的高级特性，这下栽跟头了.... 白费时间，还不如用最常规、简单的方法：代码中转复制，什么事都没了。毕竟通常事情都是有代价的。</p><hr><p>自定义控件定义的组件，其绑定属性跟随的是 DataContext 。</p><p>另外，自定义的绑定数据，Set 方法是不会被调用的！！！</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">readonly</span> <span class="token class-name">StyledProperty<span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">?</span><span class="token punctuation">></span></span> IsPlaintextProperty <span class="token operator">=</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    AvaloniaProperty<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Register</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SimpleMarkdownViewer<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token punctuation">?</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">nameof</span><span class="token punctuation">(</span>IsPlaintext<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                                                           <span class="token named-parameter punctuation">defaultBindingMode</span><span class="token punctuation">:</span> BindingMode<span class="token punctuation">.</span>TwoWay<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span><span class="token punctuation">?</span></span> IsPlaintext</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">get</span> <span class="token operator">=></span> <span class="token function">GetValue</span><span class="token punctuation">(</span>IsPlaintextProperty<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">set</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token function">SetValue</span><span class="token punctuation">(</span>IsPlaintextProperty<span class="token punctuation">,</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        MarkdownScrollViewer<span class="token punctuation">.</span>IsVisible <span class="token operator">=</span> <span class="token operator">!</span>IsPlaintext <span class="token operator">??</span> <span class="token boolean">false</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        BlockTextScrollViewer<span class="token punctuation">.</span>IsVisible <span class="token operator">=</span> IsPlaintext <span class="token operator">??</span> <span class="token boolean">true</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>如果想要在 Set 的时候做点什么，必须通过重载来额外判断：</p><figure class="highlight csharp"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token generic-method"><span class="token function">OnPropertyChanged</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token class-name">AvaloniaPropertyChangedEventArgs<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span> change<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">OnPropertyChanged</span><span class="token punctuation">(</span>change<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>change<span class="token punctuation">.</span>Property <span class="token operator">==</span> IsPlaintextProperty<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 在这里处理 IsPlaintext 属性的变化</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name"><span class="token keyword">var</span></span> newValue <span class="token operator">=</span> change<span class="token punctuation">.</span>NewValue<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetValueOrDefault</span><span class="token generic class-name"><span class="token punctuation">&lt;</span><span class="token keyword">bool</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        MarkdownScrollViewer<span class="token punctuation">.</span>IsVisible <span class="token operator">=</span> <span class="token operator">!</span>newValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        BlockTextScrollViewer<span class="token punctuation">.</span>IsVisible <span class="token operator">=</span> newValue<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><hr><p>鉴于上面使用 Avalonia.Markdown 的一些问题 (最主要还是配合 Fluent 主题渲染直接报错、配合 Simple 主题也显示难看)，而且 Demo 源码也跑不了。</p><p>所以折腾半晌，就又把 Avalonia.HtmlRenderer 拿来试了下，效果有，但是不大好，感觉画风都不是一套的了.... 而且真的卡，放几个对话记录就感觉有点吃不消了 —— 也许可以考虑统一封装到 SimpleMarkdownViewer，由设置项控制用哪个渲染。</p><hr><p>搞 Avalonia.HtmlRenderer 又折腾到晚上了... 这东西默认会给文本上下加上 20 像素的空白长度..... 字体也不对劲.... 另外排版上最后觉得还是做分页吧，现在这种 Scroll 套 Scroll 进度条变来变去，体验也不好：</p><p><img data-src="/blogimages/2024/2024-10-20/image2.png" alt=""></p><p><img data-src="/blogimages/2024/2024-10-20/image3.png" alt=""></p><p>今天最后决定还是用 Avalonia.HtmlRenderer 了，因为跟着追源码，一边追一边调，已经发现正确修改这些问题 (包括字体、边距、自适应宽、高) 的方法了。</p><ul><li>字体：可以生效，只是里面通过系统文字名字映射的，得完全一致，很不稳定对不上就花了，所以决定自定义字体，全都用一套。</li><li>边距：可以考虑 Markdown 渲染成 Html 的时候在就加上 markgin 上下 20px，当然，仅限于第一个<p>标签和最后一个。</p></li><li>自适应宽高：重载容器 (SimpleMarkdownViewer) MeasureOverride 方法，对 HtmlLabel 做 AutoSize 下的 MaxWidth 限制。</li><li>文字色根据主题切换：渲染 Html 时加上对于主题颜色，OnThemeChanged 事件中重新渲染 Html。</li></ul><p>至于 Avalonia.Markdown，代码高亮强依赖 AvaloniaEdit，AvaloniaEdit 强依赖 FluntTheme，而 Avalonia.Markdown 不能使用 FluntTheme，渲染要直接报错.... 只能用 Avalonia.Markdown.FluntTheme 配合 SimpleTheme 主题才能正常渲染，但是代码高亮啥的都炸了，连文字选中表现都不对劲， 一环套一环。</p><p>而且源码 Demo 拉下来一堆报错，跑不了。目前就是是之前折腾了一天多的结论，看看维护时间好像也已经没维护了，上面说的渲染报错问题，git issue 有人 push commit 好像也没看到反应，只能先放弃。</p><p>结果一通折腾下来，又是 11 点多，国庆还是太肝了... 明天先把字体问题解决了，然后计划：</p><ul><li>去掉聊天页面的动态虚拟化 (体验下来，对于存在不固定 Item 的情况下，简直是负优化)</li><li>把分页做了</li><li>加点工具设置的东西、优化下设置排版</li><li>优化下日志排版，现在也是虚拟化， Scroll 体验不对劲，要么改成 Item 固定高度，要么用内联文字？</li></ul><h1 id="2024年10月6日"><a class="anchor" href="#2024年10月6日">#</a> 2024 年 10 月 6 日</h1><p>早上起床就开始找开源字体，准备将应用字体与 Avalonia.HtmlRenderer 保持一致。</p><ul><li>注：看代码 HtmlRenderer 只支持一个字体，因此在 html style 定义多个字体的情况不行，找到第一个字体存在就直接用了，不会检测文字是否适合</li></ul><p>字体的坑：</p><ul><li>Avalonia 的字体加载，是依靠字体内部的 FamilyName，一般都看不到....</li><li>所以文件路径是不行的，注意连空格都得有，直接打开字体看到的中文名字是不行的！</li></ul><hr><p>Avalonia.HtmlRenderer 好像也不行啊，中英文混排巨坑：</p><p><img data-src="/blogimages/2024/2024-10-20/image4.png" alt=""></p><p>搞半天发现这个又坏了... 还是是因为我自己编译导致的？因为现在 nuget 上的版本很旧，自定义字体貌似都不支持，所以才拉下来自己编译了个....</p><hr><p>测试了下还真是... 看来最新版本还没发布也是有一定原因的... 看记录今年都有不少修改，但是 nuget 已经是去年的版本了。</p><hr><p>反编译查了下 nuget 版本，找到添加字体的入口了，在 HtmlRender 里面，直接是静态方法了，之前还以为可能得反射去查了呢 —— 这不是比改版后的方便么？AvaloniaAdapter nuget 版本是个单例，而且改版后还变成成员了。这样不是还得看啥时候添加、或者每次创建要给都得单独加一次.... 虽然是字典没关系。</p><p>反正既然老版本有设置字体的地方，那就直接换回 nuget 版本了，直接在 SimpleMarkdownViewer 静态构造函数里面初始化一次。</p><p>我就说今天又忙活了一天，之前好像也没感觉，怎么排版就挂了？差点吓惨了，因为立刻在官方 Demo 上试了下中英文混排也是乱的，都在想是不是要把 Avalonia.Markdown 也加进来，然后整个设置可选项了....</p><p>换回 nuget 版本果然没渲染问题，字体看着也 OK：</p><p><img data-src="/blogimages/2024/2024-10-20/image5.png" alt=""></p><h1 id="2024年10月7日"><a class="anchor" href="#2024年10月7日">#</a> 2024 年 10 月 7 日</h1><p>添加 OpenAI 模式 BPE 分词器计算。 解决聊天 UI 抖动问题，见 <a href="/2024/10/07/%E4%BD%BF%E7%94%A8Avalonia%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95-ItemsControl/" title="使用Avalonia的踩坑记录:ItemsControl">使用Avalonia的踩坑记录:ItemsControl</a>，晚上还单独写了篇这个研究记录，导致本篇日志也没时间弄了。</p><h1 id="总结"><a class="anchor" href="#总结">#</a> 总结</h1><p>记录有点乱，像流水账... 之所以没当天就写完是因为本来想整理下的，但是如今过了两周发现又不知道写啥好，就先这样吧。</p><p>毕竟考虑到确实折腾了这么久，不记录一下就没有意义了：没想到国庆肝了七天，抠细节想搞好的话，什么东西都难搞... 本来想国庆研究 UE5 的，结果全搞这个 Avalonia 和 AI 去了。后面上班了甚至感觉好像连续一个月都在上班一样，有点顶不住，接下来准备先缓一缓了。</p><div class="tags"><a href="/tags/Avalonia/" rel="tag"><i class="ic i-tag"></i> Avalonia</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-10-20 20:02:11" itemprop="dateModified" datetime="2024-10-20T20:02:11+08:00">2024-10-20</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>WangJiaYing <i class="ic i-at"><em>@</em></i>CWHISME</li><li class="link"><strong>本文链接：</strong> <a href="https://wangjiaying.top/2024/10/20/UiharuMind%E5%9B%BD%E5%BA%86%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" title="UiharuMind 国庆开发笔记">https://wangjiaying.top/2024/10/20/UiharuMind国庆开发笔记/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/10/07/%E4%BD%BF%E7%94%A8Avalonia%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95-ItemsControl/" itemprop="url" rel="prev" data-background-image="&#x2F;images&#x2F;coverimages&#x2F;large&#x2F;6833939bly1gipev1x5e4j20zk0m8b29.webp" title="使用Avalonia的踩坑记录:ItemsControl"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Avalonia</span><h3>使用Avalonia的踩坑记录:ItemsControl</h3></a></div><div class="item right"><a href="/2025/02/16/UiharuMind%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" itemprop="url" rel="next" data-background-image="&#x2F;images&#x2F;coverimages&#x2F;large&#x2F;6833939bly1gipexj2jgzj20zk0m8b09.webp" title="UiharuMind 工具使用指南"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 工具</span><h3>UiharuMind 工具使用指南</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%881%E6%97%A5"><span class="toc-number">1.</span> <span class="toc-text">2024 年 10 月 1 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%882%E6%97%A5"><span class="toc-number">2.</span> <span class="toc-text">2024 年 10 月 2 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%883%E6%97%A5"><span class="toc-number">3.</span> <span class="toc-text">2024 年 10 月 3 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%884%E6%97%A5"><span class="toc-number">4.</span> <span class="toc-text">2024 年 10 月 4 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%885%E6%97%A5"><span class="toc-number">5.</span> <span class="toc-text">2024 年 10 月 5 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%886%E6%97%A5"><span class="toc-number">6.</span> <span class="toc-text">2024 年 10 月 6 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2024%E5%B9%B410%E6%9C%887%E6%97%A5"><span class="toc-number">7.</span> <span class="toc-text">2024 年 10 月 7 日</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">8.</span> <span class="toc-text">总结</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2024/05/26/Avalonia%E4%B8%80%E4%BA%9B%E8%AE%B0%E5%BD%95/" rel="bookmark" title="Avalonia一些记录">Avalonia一些记录</a></li><li><a href="/2024/10/07/%E4%BD%BF%E7%94%A8Avalonia%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95-ItemsControl/" rel="bookmark" title="使用Avalonia的踩坑记录:ItemsControl">使用Avalonia的踩坑记录:ItemsControl</a></li><li class="active"><a href="/2024/10/20/UiharuMind%E5%9B%BD%E5%BA%86%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" rel="bookmark" title="UiharuMind 国庆开发笔记">UiharuMind 国庆开发笔记</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="WangJiaYing" data-src="/images/../img/avator"><p class="name" itemprop="name">CWHISME</p><div class="description" itemprop="description">己所不欲，勿施于人</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">131</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">24</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">35</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N3aGlzbWU=" title="https:&#x2F;&#x2F;github.com&#x2F;cwhisme"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jd2hpc21lLTMzL3Bvc3Rz" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;cwhisme-33&#x2F;posts"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmN3aGlzbWVAMTI2LmNvbQ==" title="mailto:cwhisme@126.com"><i class="ic i-envelope"></i></span> <a href="/atom.xml" title="&#x2F;atom.xml" class="item feedback"><i class="ic i-heart"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/statistics/" rel="section"><i class="ic i-clock"></i>统计</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/10/07/%E4%BD%BF%E7%94%A8Avalonia%E7%9A%84%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95-ItemsControl/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2025/02/16/UiharuMind%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" title="分类于 阅读笔记">阅读笔记</a></div><span><a href="/2023/06/12/NET%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E5%AE%9D%E5%85%B8_1/" title="《.NET内存管理宝典》-笔记(1)">《.NET内存管理宝典》-笔记(1)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%80%BB%E7%BB%93/" title="分类于 总结">总结</a></div><span><a href="/2017/01/05/2016%E5%B9%B4%E6%80%BB%E7%BB%93/" title="2016年总结">2016年总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%90%86%E8%AE%BA%E7%A0%94%E7%A9%B6/" title="分类于 理论研究">理论研究</a> <i class="ic i-angle-right"></i> <a href="/categories/%E7%90%86%E8%AE%BA%E7%A0%94%E7%A9%B6/C/" title="分类于 C#">C#</a></div><span><a href="/2022/11/18/StringBuilder%E6%89%A9%E5%AE%B9%E8%A7%84%E5%88%99%E7%A0%94%E7%A9%B6/" title="StringBuilder 扩容规则研究">StringBuilder 扩容规则研究</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment count_3"></ul></div></div><div class="status"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2025</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">WangJiaYing @ Jiaying's Note</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">772k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">11:42</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NXSElTTUUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/10/20/UiharuMind国庆开发笔记/",favicon:{show:"（●´3｀●）",hide:"(´Д｀)"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,justifiedGallery:!0,jquery:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.staticfile.net/pace/1.2.4/pace.min.js"></script><script src="https://cdn.staticfile.net/pjax/0.2.8/pjax.min.js"></script><script src="https://cdn.staticfile.net/animejs/3.2.2/anime.min.js"></script><script src="https://cdn.staticfile.net/algoliasearch/4.17.0/algoliasearch-lite.umd.js"></script><script src="https://cdn.staticfile.net/instantsearch.js/4.54.1/instantsearch.production.min.js"></script><script src="https://cdn.staticfile.net/lozad.js/1.16.0/lozad.min.js"></script><script src="https://cdn.staticfile.net/quicklink/2.3.0/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/js/DateTimeAfeterCalc.js" async></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js" async></script></body></html>