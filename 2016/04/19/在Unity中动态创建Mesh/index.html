<!DOCTYPE html><meta name="viewport" content="height=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="cwhisme"><meta name="author" content="CWHISME"><meta property="og:title" content="在Unity中动态创建Mesh"><meta property="og:description" content="cwhisme"><meta property="og:site_name" content="WangJiaYing"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>在Unity中动态创建Mesh - WangJiaYing</title><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/DateTimeAfeterCalc.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/particles-bg.js"></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/script.js"></script><link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/css/style.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="WangJiaYing" type="application/atom+xml">
</head><body><canvas id="hackEffectCanvas" style="position:fixed;z-index:-1;pointer-events:none"></canvas><canvas class="fireworks" style="position:fixed;z-index:10;pointer-events:none"></canvas><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="WangJiaYing"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/logo.svg" class="dib h3" alt="WangJiaYing"></a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">Tags </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/categories" title="Categories">Categories </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/bookmark" title="Bookmark">Bookmark </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about" title="About">About</a></div></nav><div class="w-100 mw8 center vh-40 dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">在Unity中动态创建Mesh</h1><p class="f4 fw3 pab-100px tc tc-m tl-ns"><i class="fa fa-calendar-check-o" aria-hidden="true"></i> 2016-04-19&nbsp&nbsp <i class="fa fa-clock-o" aria-hidden="true"></i> <span id="dateTimeAfter">2016-04-19</span></p></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-snowflake-o"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><p>Mesh,即模型。一般情况下是不会在Unity里边来创建的，除非有特殊需求，比如说一个纯粹跟随玩家鼠标，表现一种“东拉西扯”效果等奇怪的功能。</p><p>动态改变Mesh暂且不谈，毕竟现在的主题主要是谈创建。那么创建一个什么样的Mesh呢？</p><p>很久以前，我记得见过一个叫“白猫计划”之类的日式网游，就是使用一个在屏幕上，可以动态跟随玩家手指进行移动、改变形状的圆圈，来操控角色进行移动的——也就是说，他们把移动按钮都做了一个特殊效果。</p><p>如图：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2016.4.19-0.JPG" alt="《白猫计划》"></p><p>我觉得那东西估计就是这么来的，所以这儿我就想仿照一下，做这么一个东西来试试。</p><p>首先，新建一个场景，确定一下坐标。因为毕竟这个“圆”相对屏幕来说，只需要一个片而已，所以我直接建立了一个2D的场景。然后新建一个空物体，默认坐标就在(0,0,0)点——也不需要去改它，只要确定处于相机范围内就可以了。另外坐标则是Y轴向上，X轴向右，Z轴面向屏幕里边，因为是2D场景，所以在这儿Z轴基本上就可以忽略了（不过当然不能完全忽略，对我们创建的模型还是有一定影响的，后面会解释）。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2016.4.19-1.JPG" alt="新场景"></p><p>然后，作为一个圆，那么我们还必须确定这个圆，究竟需要有多少个顶点？不过实际上这个问题是没什么定论的，从理论上来说，只要你能让这些顶点围成一个圈，那么就足够了(当然如果非得用几十个顶点画，那么跟几百个顶点画的，视觉上完全不是一个档次)。因为一般来说，一个圆有360度，随意这儿我就直接选用361个顶点了。</p><p>为什么是361个顶点呢？想一想，在Unity中，构成多边形的基础是什么？——三角形。那么就必须得三个顶点才能构成一个三角形，如果是360个顶点的话，怎么能把这个圆分成完全密封的多个三角形呢？</p><p>所以多出来的那一个顶点，是作为这个圆的原圆心存在，起一个链接各个边上顶点的作用。如图：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2016.4.19-2.JPG" alt="圆"></p><p>我的计划就是：首先从中心点到Y轴正上方的一条边，作为这个圆的起始点，然后每隔一度(因为这儿360个顶点差不多刚好是360度)，将这条边旋转一度，这样，每次旋转后，都会获得下一个顶点的位置。如图所示：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2016.4.19-3.JPG" alt="边的旋转"></p><p>最终转过360度，从理论上来说，就会形成一个完美的圆了。</p><p>Ok，原理就是这样，那么接下来是代码。</p><p>首先，定义一个半径，以控制圆的大小：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="built_in">float</span> m_radius = <span class="number">5f</span>;</span><br></pre></td></tr></table></figure><p>然后是MeshRender、MeshFileter两个Unity渲染Mesh必备组件，以及盛放顶点、三角形索引的列表(这些算是最低的要求了)、材质：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> MeshRenderer m_renderer;</span><br><span class="line"><span class="keyword">private</span> MeshFilter m_meshFilter;</span><br><span class="line"><span class="keyword">public</span> Material m_material;</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">List</span>&lt;<span class="title">Vector3</span>&gt; m_vertexList</span> = <span class="keyword">new</span> List&lt;Vector3&gt;();</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="title">List</span>&lt;<span class="title">int</span>&gt; m_triangles</span> = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br></pre></td></tr></table></figure><p>然后，在Start初始化中，首先判断或者初始化Meshrender及MeshFileter,并赋予相应的材质，避免创建出来的Mesh材质丢失：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">m_renderer = GetComponent&lt;MeshRenderer&gt;();</span><br><span class="line"><span class="keyword">if</span> (!m_renderer)</span><br><span class="line">    m_renderer = gameObject.AddComponent&lt;MeshRenderer&gt;();</span><br><span class="line">m_renderer.material = m_material;</span><br><span class="line">m_meshFilter = GetComponent&lt;MeshFilter&gt;();</span><br><span class="line"><span class="keyword">if</span> (!m_meshFilter)</span><br><span class="line">    m_meshFilter = gameObject.AddComponent&lt;MeshFilter&gt;();</span><br></pre></td></tr></table></figure><p>接下来，就是创建Mesh的关键代码了：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">      <span class="comment">//在这儿，首先创建一个新的Mesh，并将其赋给MeshFilter组件</span></span><br><span class="line">      m_mesh = <span class="keyword">new</span> Mesh();</span><br><span class="line">      m_mesh.name = <span class="string">&quot;Button&quot;</span>;</span><br><span class="line">      m_meshFilter.mesh = m_mesh;</span><br><span class="line"></span><br><span class="line">      <span class="comment">//初始化圆心</span></span><br><span class="line">      m_vertexList.Add(transform.position);</span><br><span class="line">      <span class="comment">//从正上方，以Z轴旋转360度，构造360个正确位置的顶点</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">361</span>; i++)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="comment">//这儿我们构造了一个四元数进行旋转</span></span><br><span class="line">          m_vertexList.Add(transform.position + Quaternion.Euler(<span class="number">0</span>, <span class="number">0</span>, i) * Vector3.up * m_radius);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//创建三角形索引</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt; <span class="number">361</span>; i++)</span><br><span class="line">      &#123;</span><br><span class="line">          m_triangles.Add(<span class="number">0</span>);</span><br><span class="line">          m_triangles.Add(i);</span><br><span class="line">          m_triangles.Add(i + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将顶点及三角形索引赋给Mesh，构造完成</span></span><br><span class="line">      m_mesh.SetVertices(m_vertexList);</span><br><span class="line">      m_mesh.SetTriangles(m_triangles, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>就是这样，接下来切入Unity，点击运行。<br>不过运行之后，发现似乎屏幕上啥都没有啊？</p><p>实际上，不是什么都没有，这个圆早已创建出来了，不信的话，可以进入Scene场景，点击左上方的“2D”关闭2D模式，朝着相机的前方移动一点，就会发现，这个圆确实是出来了，如图：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2016.4.19-4.JPG" alt="图"></p><p>不过，视角一换回相机前方，这个圆就消失了？</p><p>为什么？</p><hr><p>实际上，这是因为我们绘制的模型只有一个片，我们按照顺时针旋转来绘制三角形，所以自然而然，那么也就只有一个“正面”，即面向模型自身的Z轴正方向的面了。而Mesh的背面，是不会渲染出来的。那么怎么办呢？解决的办法很多，比如换双面Shader啊、或者干脆把模型转个180度换过来都可以解决。</p><p>不过我采用的方法是：反向绘制三角形。</p><p>回到代码，将设置三角形索引的循环稍微改一下：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">361</span>; i &gt; <span class="number">0</span>; i--)</span><br><span class="line">&#123;</span><br><span class="line">    m_triangles.Add(<span class="number">0</span>);</span><br><span class="line">    m_triangles.Add(i);</span><br><span class="line">    m_triangles.Add(i - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样的话，就是反向绘制了。</p><p>然后回到场景，再次运行，就可以顺利看见了。如图：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/oldpictures/2016.4.19-5.JPG" alt="最后的样子"></p><p>最后，本来打算将动态改变顶点，做点好玩的效果出来的方法也一并写一写的，结果发现就写这么些东西，时间又是10点多了…..现在太晚了，决定还是下次吧。</p><p>就是这样。</p><br><br><hr><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><div id="vcomments"></div><script>new Valine({el:"#vcomments",appId:"MsaVbSzIr9cIfikihDExdun9-gzGzoHsz",appKey:"Bj6SEFUBomrLOTWx9B8S6zQH",placeholder:"请输入评论内容~",avatar:"mp",visitor:!1})</script></div><div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50"><hr class="dn-l mw4 black-50 mt5"><div class="mt5 mt0-l site-author"><article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3"><div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width:6rem"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/photo.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="CWHISME"></div><div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">悲观主义的末日</div></article></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>分类</h3><p><a href="/categories/Unity3D/">Unity3D</a></p></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>近期文章</h3><p><a href="/2022/12/10/%E5%8D%8F%E5%8F%98%E5%92%8C%E9%80%86%E5%8F%98/">协变和逆变</a></p><p><a href="/2022/12/06/Unity%E7%9A%84%E9%98%B4%E5%BD%B1%E4%B8%8E%E5%85%89%E7%85%A7%E7%83%98%E7%84%99/">Unity 的阴影与光照烘焙</a></p><p><a href="/2022/11/23/%E6%89%93%E5%8C%85AssetBundle%E5%9F%BA%E7%A1%80%E8%A7%84%E5%88%99%E6%95%B4%E7%90%86/">打包 AssetBundle 的基础规则整理</a></p><p><a href="/2022/11/18/StringBuilder%E6%89%A9%E5%AE%B9%E8%A7%84%E5%88%99%E7%A0%94%E7%A9%B6/">StringBuilder 扩容规则研究</a></p><p><a href="/2022/11/17/%E6%B5%8B%E8%AF%95%E6%89%8B%E5%8A%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">简单测试手动垃圾回收</a></p></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://github.com/CWHISME" target="_blank"><i class="fa fa-github"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="mailto:cwhisme@126.com" target="_blank"><i class="fa fa-envelope"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div></div><div class="f6 f5-ns center tc white pt5 fw3">Copyright © 2021 | Design & Hexo <a class="link dim white" target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-anodyne/">Jonathan Klughertz</a> | Modify By CWHISME</div></div></div></body></html>