<!DOCTYPE html><meta name="viewport" content="height=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="cwhisme"><meta name="author" content="CWHISME"><meta property="og:title" content="图片资源格式设置测试与总结"><meta property="og:description" content="cwhisme"><meta property="og:site_name" content="WangJiaYing"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>图片资源格式设置测试与总结 - WangJiaYing</title><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/DateTimeAfeterCalc.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/particles-bg.js"></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/script.js"></script><link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/css/style.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="WangJiaYing" type="application/atom+xml">
</head><body><canvas id="hackEffectCanvas" style="position:fixed;z-index:-1;pointer-events:none"></canvas><canvas class="fireworks" style="position:fixed;z-index:10;pointer-events:none"></canvas><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="WangJiaYing"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/logo.svg" class="dib h3" alt="WangJiaYing"></a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">Tags </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/categories" title="Categories">Categories </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/bookmark" title="Bookmark">Bookmark </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about" title="About">About</a></div></nav><div class="w-100 mw8 center vh-40 dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">图片资源格式设置测试与总结</h1><p class="f4 fw3 pab-100px tc tc-m tl-ns"><i class="fa fa-calendar-check-o" aria-hidden="true"></i> 2022-10-26&nbsp&nbsp <i class="fa fa-clock-o" aria-hidden="true"></i> <span id="dateTimeAfter">2022-10-26</span></p></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-snowflake-o"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><div class="tags-container-vertical"><div class="tags-sub-container"><a class="fw3 ph1 dib" href="/tags/性能优化/">#性能优化</a></div></div><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在今年10月份这次评审的时候，有问到图片设置相关的内容，当时感觉也是没回答多好。</p><p>例如，ETC1 与 ETC2 相比有什么差别？</p><p>回答的是 ETC1 不带 Alpha 通道，ETC2 带 Alpha 通道，其它就差不多(实际上压缩质量也会高一点)</p><p>有问到如果 ETC 质量不佳怎么办？回答的是用 RGBA 设置看效果，而且还被追问除此之外呢？是否直接就用 RGBA 了？</p><p>下来后才想明白，意思应该是想问 ASTC 的，然而当时不知是觉得这个格式项目没有实际普及还是什么，根本没回答这个点…甚至回答上都没提到 ASTC，虽然 ASTC 这格式肯定是知道，ios、android 新机型通用的一种图片压缩格式，估计也跟只在理论上了解、却没自己实践对比有关——就很难反应过来。</p><p>因此这里就对这些格式挨个进行尝试、对比，整理一下自己了解的差异，以期得到更好的理解。</p><h2 id="图片设置"><a href="#图片设置" class="headerlink" title="图片设置"></a>图片设置</h2><p>sRGB 选项，本身处于 gamma 颜色空间内时，勾选与否都不影响。<br>处于线性颜色空间内时，勾选后才会做校正。</p><p>Mipmap：UI肯定不能勾，3D模型勾不勾取决于有没有相机远近操作及内存平衡。</p><h2 id="图片压缩格式"><a href="#图片压缩格式" class="headerlink" title="图片压缩格式"></a>图片压缩格式</h2><p>为什么需要压缩？</p><blockquote><p>减少内存、减少数据传输带宽需求，压缩是有损的。</p></blockquote><h3 id="压缩格式"><a href="#压缩格式" class="headerlink" title="压缩格式"></a>压缩格式</h3><p>对此官方文档也有列表说明：</p><p><a target="_blank" rel="noopener" href="https://docs.unity.cn/cn/2021.2/Manual/class-TextureImporterOverride.html">class-TextureImporterOverride</a></p><h4 id="一、RGBA"><a href="#一、RGBA" class="headerlink" title="一、RGBA"></a>一、RGBA</h4><p>RGBA 格式主要分为：</p><p>RGBA64：每个像素64位，每个通道16位<br>RGBA32：每个像素32位，每个通道8位<br>RGBA16：每个像素16位，每个通道4位</p><p>其中 RGBA64、RGBA32 均为无压缩，RGBA16 官方文档说是『量化』模式，可能是靠直接量化缩放减少像素精度以减少内存占用，不过这种模式质量损失其实感觉有点大，对比了下还不如 ASTC4x4 压缩。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_42dd7d724910306bfad9c502639914ee_r.gif"><br>分辨率 128x128，RGBA32-&gt;ASTC4x4，大小为 32kb-&gt;16kb(质量和大小都不占优)</p><p>RGBA64 高精度模式，图片本身不支持的情况下，设置了也只是浪费内存，所以基本上可以把 RGBA32 当做『原图』看待。</p><h4 id="二、ECT1"><a href="#二、ECT1" class="headerlink" title="二、ECT1"></a>二、ECT1</h4><p>安卓，不带 Alpha 通道，4bits/pixel<br>强行要求图片分辨率为 2N 次方。</p><h4 id="三、ETC2"><a href="#三、ETC2" class="headerlink" title="三、ETC2"></a>三、ETC2</h4><p>安卓，带 Alpha 通道 8bits/pixel，不带Alpha通道 4bits/pixel，质量比 ETC1 好。<br>强行要求图片分辨率为 2N 次方。</p><p>ETC1 与 ETC2 对比（128x128&amp;10.7kb）：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_c127eafb4fe2f0fd9f71884b89aa3b01_r.gif"></p><p>(字体边缘变化模糊度更低的就是 ETC2)</p><blockquote><p>ETC2 还有一种支持镂空图(无Alpha过度)的模式(RGB+1bit Alpha)，也是 4 bits/pixel，这个格式网上没有解释如何处理的，猜测是将 Alpha 0.5 为界限，完全透明或不透明。</p></blockquote><p>我用 PS 大概画了一张渐变图进行测试，设置后对比效果如下：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_a826a55fc92b56bcb2afebe58984bf6d_r.png"></p><p>例如：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_609ff492c0b942aa2caa9c7a78074344_r.png"><br>左边为 ETC2 RGB+1bit Alpha 4Bit(8KB)，右边为 ETC2 RGBA 8Bit(16KB)<br>整体质量相对会差一点，不过相比常规 ETC2 RGBA 省一半内存。感觉这种适合效果要求不是很高、小一些的无渐变的纯透明图标，不过边缘像素必须处理好，不然边缘可能会比较明显，或者存在锯齿。</p><p>注：ETC 和 ETC2 在 Unity 还有种 Crunched 模式，可以自己选择压缩比(不过 ETC2 只有 RAGB Crunched)，这种模式会增加一定解压消耗，因为它会在 CPU 上将该纹理解压缩为 ETC 传给 GPU(虽然官方称解压过程『非常快』)，更多见 <a target="_blank" rel="noopener" href="https://docs.unity.cn/cn/2021.1/Manual/texture-compression-formats.html">官方文档</a> 说明。</p><h4 id="四、ASTC"><a href="#四、ASTC" class="headerlink" title="四、ASTC"></a>四、ASTC</h4><p>文档表示同等压缩率下，效果比 ETC2 更好，其 blockSize 越大压缩率越高，压缩分块从 4x4 到 12x12 最终可以压缩到每个像素占用1bit以下</p><p>其原理是将图片分块，每块颜色固定为 16bytes，然后通过控制每块存放多少像素(4x4、6x6)来控制压缩率，所以存放颜色越多压缩率越高，效果就越差。</p><p>不像 ETC、PVRTC 强行要求分辨率 2N 次方，当然符合这个规则的图片最好。<br>参考：<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/376921536/answer/1063272336">https://www.zhihu.com/question/376921536/answer/1063272336</a></p><p>与 RGBA 格式相比：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_1cdadb33b2ad7d459502ea3928123fdb_r.png"></p><p>计算公式为：压缩后像素大小=16bytes/(分块宽高)x8bit</p><p>尝试计算一张 1024x1024 图片在 ASTC 10x10 下的大小：</p><p>压缩后每像素颜色占用：16/(10x10)x8=1.28bit<br>原本大小：1024x1024x32=4MB<br>4MB/(32/1.28)=1024x1024x1.28=1342177.28bit=163.84KB</p><p>ASTC 的 Alpha 通道是自动识别的(特指安卓平台，ios 倒是可以单独选择是否带Alpha通道格式)。如果带 Alpha 通道，可以设置更低的 block size，否则可以设置更高的 size。<br>例如，根据压缩率的对比，若将 4x4 作为带 Alpha 透明通道图片标准：</p><ul><li>4x4=8bit=RGBA(32bit)=压缩率4倍</li><li>不带 Alpha 通道 压缩率4倍=RGB(24bit)/4=6bit~5x5</li></ul><p>当然，换算也不绝对，还是要看实际图片效果进行确定，不过感觉一般通用可以按照这种规则来，若某些特定图片出现可见的损失则手动处理。</p><p>对比了一下：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_a3628ccb80bd4c4bf8a34d6efe7dfc91_r.gif"><br>分辨率 128x128，ETC2-&gt;ASTC4x4，大小为 16kb-&gt;16kb</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_e08338c3627fd662eaebe5a10151a8c9_r.gif"><br>分辨率 128x128，ETC2-&gt;ASTC5x5，大小为 16kb-&gt;10.6kb</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_dce12c80ae66fc19ac3437d779f5a89c_r.gif"><br>分辨率 128x128，ETC2-&gt;ASTC6x6，大小为 16kb-&gt;7.6kb</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_5aa5d2788a135af160a24bf2a58eac85_r.gif"><br>分辨率 128x128，ETC2-&gt;ASTC8x8，大小为 16kb-&gt;4kb</p><p>同一张带 Alpha 通道的 Icon 图片，直到 ASTC8x8 的时候才与 ETC2 有了比较明显的差距(比之更糊点)，但是大小可是小了4倍！那怕 ASTC6x6 也小了一倍以上，且效果更好。</p><p>最后，再分别使用 ASTC4x4、ETC2 与 RGBA32(也就是原图) 进行对比：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_0725399211d37c2164d73402e59dc5f2_r.gif"><br>分辨率 128x128，RGBA32-&gt;ASTC4x4，大小为 64kb-&gt;16kb ↑</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_3e3bb61964458ed75820064d9196d2e1_r.gif"><br>分辨率 128x128，RGBA32-&gt;ETC2，大小为 64kb-&gt;16kb ↑</p><p>其中，RGBA32-&gt;ASTC4x4 损失的质量很少，RGBA32-&gt;ETC2 质量损失就比较明显了。</p><p>后续还测试了 RGBA32-&gt;ASTC5x5，虽然噪点更多，不过在宏观上来看，对于小图来说基本跟原图差别不是很大。</p><p>虽然按照文档所说，ASTC 效果会比 ETC2 更好，不过设置更高的 block 获得更高压缩率后效果肯定还是会降低，这是压缩率跟质量必然的取舍。不过大的 ASTC block 压缩率是真的高，而且 ios 和 android 都支持(除了非常非常老的设备——iPhone6以前、android OpenGLES3.0 部分及所有 OpenGLES3.1 GPU)。</p><h4 id="五、PVRTC"><a href="#五、PVRTC" class="headerlink" title="五、PVRTC"></a>五、PVRTC</h4><p>IOS(GPU) 专用，强行要求图片分辨率为 2N 次方的方形。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_cfd9379259a7046ae87bffb4e9f287ec_r.png"><br>从左自右分别是：ASTC4x4(16kb)-&gt;ASTC6x6(7.6kb)-&gt;ASTC8x8(4kb)-&gt;PVRTC_4bit(8kb)-&gt;PVRTC_2bit(4kb)</p><p>就实际结果而言，PVRTC 2bit 糊得基本没法看，而 PVRTC 4bit 实际效果，基本也就跟 ASTC8x8 差不多，细节上甚至还差一点——而 ASTC8x8 容量却比它低了一半。</p><p>PVRTC 4bit 只能说比 ASTC10x10 好些——但 ASTC10x10 都直接压缩到 2.6kb 了</p><p>所以 ASTC 在 ios 上的质量/压缩比优势比在 android 平台更大，如果目标机型不是 iPhone6(iPhone6支持) 以前的设备，最好就使用 ASTC 了。</p><h4 id="六、其它"><a href="#六、其它" class="headerlink" title="六、其它"></a>六、其它</h4><p>除此之外，还有部分『其它』格式，例如：</p><ul><li>R8：未压缩单通道 (R)</li><li>Alpha 8：未压缩单通道 (A)</li><li>EAC：与 ETC 类似，不过只有单通道或双通道。</li><li>R EAC 4 bit ：压缩单通道 (R)</li><li>RG EAC 8 bit ：压缩双通道 (RG)</li><li>等</li></ul><p>详细解释在官方文档 <a target="_blank" rel="noopener" href="https://docs.unity.cn/cn/2021.2/Manual/class-TextureImporterOverride.html">class-TextureImporterOverride</a> 也都有说明，不过这些诸如拆分通道的格式，基本上不常用(或者说没见过用)，或许某些情况下，写 Shader 只需要单通道之类的可能会用到？</p><h2 id="压缩后对-AssetBundle-影响"><a href="#压缩后对-AssetBundle-影响" class="headerlink" title="压缩后对 AssetBundle 影响"></a>压缩后对 AssetBundle 影响</h2><p>在对图片格进行一堆测试之后，心里就冒出一个想法：</p><blockquote><p>既然图片本体进行了压缩，那么对最终资源大小有影响吗？如果图片本身压缩后，AssetBundle 打包无法减少更小，是否可以选择对图片采取不压缩，或者 LZ4 压缩模式？</p></blockquote><p>于是找了一张图进行测试，由于这张图片不是 POT 分辨率，因此以 ASTC与RGBA32(原图) 为例。</p><p>简单的测试代码如下：</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">MenuItem(<span class="meta-string">&quot;AssetBundleTest/PackSelect(LZMA)&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PackSelectLZMA</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    PackSelect(BuildAssetBundleOptions.DeterministicAssetBundle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">MenuItem(<span class="meta-string">&quot;AssetBundleTest/PackSelect(LZ4)&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PackSelectLZ4</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    PackSelect(BuildAssetBundleOptions.DeterministicAssetBundle | BuildAssetBundleOptions.ChunkBasedCompression);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">MenuItem(<span class="meta-string">&quot;AssetBundleTest/PackSelect(Uncompress)&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PackSelectUncompress</span>(<span class="params"></span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    PackSelect(BuildAssetBundleOptions.DeterministicAssetBundle | BuildAssetBundleOptions.UncompressedAssetBundle);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PackSelect</span>(<span class="params">BuildAssetBundleOptions opt</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Object o = Selection.activeObject;</span><br><span class="line">    <span class="built_in">string</span> path = AssetDatabase.GetAssetPath(o);</span><br><span class="line">    AssetImporter importer = AssetImporter.GetAtPath(path);</span><br><span class="line">    <span class="keyword">if</span> (importer == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    AssetBundleBuild build = <span class="keyword">new</span> AssetBundleBuild();</span><br><span class="line">    build.assetBundleName = importer.assetBundleName;</span><br><span class="line">    build.assetNames = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; path &#125;;</span><br><span class="line"></span><br><span class="line">    BuildPipeline.BuildAssetBundles(Path.Combine(Application.dataPath, <span class="string">&quot;MyBundles&quot;</span>), <span class="keyword">new</span> AssetBundleBuild[] &#123; build &#125;, opt, EditorUserBuildSettings.activeBuildTarget);</span><br><span class="line">    AssetDatabase.Refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对比结果：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_45ae9e30c0769a8bf06e42f270e4b5b0_r.png"><br>RGBA(1.8M)-&gt;LZMA(449kb[25%])-&gt;LZ4(755kb[41%])-&gt;不压缩(1.85M[102%])</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_6cb8901537c88400d2f74a18cfbf539f_r.png"><br>ASTC4x4(462.2kb)-&gt;LZMA(273kb[59%])-&gt;LZ4(303kb[65%])-&gt;不压缩(467kb[101%])</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_143d4ebe0f769145f38441f41cbbe99a_r.png"><br>ASTC12x12(52.1kb)-&gt;LZMA(33kb[63%])-&gt;LZ4(37kb[71%])-&gt;不压缩(57kb[109%])</p><p>ETC2 压缩模式对于 NPOT 的图片，勾选 ToNearest(正常被压缩) 以及不勾选(无法正常被压缩为ETC2) 的大小：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_7625bcb93b3ed36ae3f31571ecd2bf35_r.png"></p><p>根据结果可以得出结论：</p><blockquote><p>被压缩过的图片，最终打出来的 AssetBundle 包压缩率也会更低——当然无论如何，图片本身进行过压缩格式压缩后，最终资源包体会更小。<br>ETC 一类如果图片是 NPOT 分辨率，则压缩将会无效</p></blockquote><p>所以从空间占用来考虑，打包时『通常压缩』格式依然还是需要选择压缩模式的。</p><p>为什么『通常压缩』要打重点？</p><p>因为后面我在测试 ETC Crunched 压缩模式时，确认这种高压模式 AssetBundle 无法再作压缩了。</p><p>依然以上述图片为例，设置为 ETC Crunched 100% 质量：<br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2022/2022-10-26/m_905a5cbc8b864c77f6b34a21e50bdef8_r.png"></p><p>打包的 AssetBundle 大小基本跟 Inspector 预览差异不大(多了一点 AssetBundle 数据)<br>所以要是选用了 ETC Crunched 模式，打包 AssetBundle 倒是可以采用『不压缩』或者『LZ4』来进一步节省加载时间。</p><h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>就算是 ASTC 压缩，如果选择开启了 Mipmap，则同样要求必须是 POT 的图，否则无法压缩——对此项 Unity 会有 Warning 提示。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>根据上述各种对比，可以得出结论：</p><ul><li><p>质量(由高到低)：RGBA32(64kb)-&gt;ASTC4x4(16kb)-&gt;ASTC5x5(10.6kb)-&gt;ASTC6x6(7.6kb)-&gt;ETC2(16kb)-&gt;ASTC8x8(4kb)~PVRTC4bit(8kb)-&gt;ASTC10x10(2.6kb)-&gt;PVRTC2bit(4kb)</p></li><li><p>大小(由高到低)：RGBA32(64kb)-&gt;ASTC4x4(16kb)-&gt;ETC2(16kb)-&gt;ASTC5x5(10.6kb)-&gt;PVRTC4bit(8kb)-&gt;ASTC6x6(7.6kb)-&gt;ASTC8x8(4kb)-&gt;PVRTC2bit(4kb)-&gt;ASTC10x10(2.6kb)</p></li></ul><p>所以，除非对非常老的机型也想支持，否则默认就可以使用 ASTC6x6 ，再视情况而定对 Block 进行增加或减少。</p><p>否则:</p><ul><li>安卓：不带 Alpha 使用 ETC2 RGB，带 Alpha 使用 ETC2 RGBA</li><li>IOS：不带 Alpha 使用 PVRTC RGB 4bit，带 Alpha 使用 PVRTC RGBA 4bit<br><font color="red">注1：ETC 要求图片为 2N 次方(长宽不强行要求一致)</font><br><font color="red">注2：PVRTC 要求图片为 2N 次方的方形(长宽强行要求一致)</font><br><font color="red">注3：IOS PVRTC 勾选 ToNearest 同样会被强行压缩为正方形，比安卓平台变形会更大(当长宽差距过大 ToNearest 也会失败)</font><br><font color="red">注4：勾选 ToNearest 时，缩放算法可以选 Bilinear ，个人对比后觉得这个细节明显更好点，默认的 Mitchell 更糊。</font></li></ul><p>另外，在实在无法启用 ASTC，但是又想减少包体大小的情况，可以考虑使用 ETC Crunched(有损压缩) 模式，该模式增加部分解压 CPU 消耗，以时间换存储空间，且对于运行时内存使用量没有影响(在<a target="_blank" rel="noopener" href="https://forum.unity.com/threads/questions-about-compression-formats-etc2-crunch-etc.511560/">加载时被解压缩</a>，官方称 解压缩速度非常快)。<br>(由于压缩率很高，文件大小减少，变相减少了 IO，对整体加载时间的影响或许不会太大？)<br><font color="red">注1：ETC Crunched 无法再被 AssetBundle 进一步压缩</font><br><font color="red">注2：ETC Crunched 压缩比非常高，经过测试可能比 ASTC12x12 都小</font><br><font color="red">注3：实测 ETC2 Crunched 100% 质量也比普通 ETC2 更糊一些</font></p><ul><li>部分无法压缩的 NPOT 图片，勾选 ToNearest 会导致效果出现问题，或者使用的不规则图片然后调用了 SetNativeSize 的情况(一般出现于老项目，比如说我们汉室复兴)，也可以采取使用 RGB16 或 RGBA16 的格式，比 32 位减少一半大小。<br><font color="red">注：优化老项目时(例如我们的项目)，对于设置 ETC2 和 RGBA16 时可以评估考虑两者具体占用大小、效果。</font>例如带透明通道 RGBA16 某些大图可能会会产生『条纹』。部分情况(RGBA)下 ToNearest ETC2(8bit） 占用比 RGBA16 还要高(512x512x8&gt;300x300x16)，强行要求方形的 PVRTC(4bit) 极端情况下可能也有类似问题(512x512x4&gt;400x100x16)。可以写个工具计算两者哪个更划算再进行设置。</li></ul><p>其它还需要注意的是官方对平台不支持纹理的说明：</p><blockquote><p>当 Unity 加载的纹理具有设备不支持的压缩格式时，它会将纹理解压缩为该平台的默认未压缩格式，并将未压缩副本与原始压缩纹理一起存储在内存中。这会增加纹理加载时间并使用额外的内存。当 Unity 加载的纹理具有设备支持的压缩格式时，GPU 可以使用该数据而无需任何转换。</p></blockquote><p>最后：<br>因为 ETC 不支持 Alpha，一些老项目会出现单独分离透明通道的做法。<br>虽然 ASTC 已经不强行要求 2N次方了，不过 POT 最好也让美术遵守一下，对性能有一定好处，<a target="_blank" rel="noopener" href="https://www.zhihu.com/question/376921536/answer/1063272336">参考</a>。</p><h2 id="疑问"><a href="#疑问" class="headerlink" title="疑问"></a>疑问</h2><p>既然 ASTC 会根据 Alpha 自动计算压缩效果，Unity(2021.3.6f1) 为安卓平台提供的 ASTC 选项也是合并在一块的，为什么 IOS 平台又是分开设置的了？</p><blockquote><p>注：Unity2018.4.36f1 安卓也是分开的，分为 ASTC RGB 和 ASTC RGBA，推测高版本 Unity 安卓平台增加了 ASTC HDR 模式后，因为设置量太多而合并？</p></blockquote><p>参考文章：</p><ul><li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/158740249">ASTC纹理压缩格式详解</a></li><li><a target="_blank" rel="noopener" href="https://docs.unity.cn/cn/2021.1/Manual/texture-compression-formats.html">texture-compression-formats</a></li><li><a target="_blank" rel="noopener" href="https://docs.unity.cn/cn/2021.1/Manual/class-TextureImporterOverride.html">class-TextureImporterOverride</a></li></ul><div class="tags-container-bottom"><i class="fa fa-tag pr3 text-main-color"></i><a class="fw3 ph1 dib" href="/tags/性能优化/">#性能优化</a></div><br><br><hr><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><div id="vcomments"></div><script>new Valine({el:"#vcomments",appId:"MsaVbSzIr9cIfikihDExdun9-gzGzoHsz",appKey:"Bj6SEFUBomrLOTWx9B8S6zQH",placeholder:"请输入评论内容~",avatar:"mp",visitor:!1})</script></div><div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50"><hr class="dn-l mw4 black-50 mt5"><div class="mt5 mt0-l site-author"><article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3"><div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width:6rem"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/photo.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="CWHISME"></div><div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">悲观主义的末日</div></article></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>分类</h3><p><a href="/categories/Unity3D/">Unity3D</a></p></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>近期文章</h3><p><a href="/2022/12/10/%E5%8D%8F%E5%8F%98%E5%92%8C%E9%80%86%E5%8F%98/">协变和逆变</a></p><p><a href="/2022/12/06/Unity%E7%9A%84%E9%98%B4%E5%BD%B1%E4%B8%8E%E5%85%89%E7%85%A7%E7%83%98%E7%84%99/">Unity 的阴影与光照烘焙</a></p><p><a href="/2022/11/23/%E6%89%93%E5%8C%85AssetBundle%E5%9F%BA%E7%A1%80%E8%A7%84%E5%88%99%E6%95%B4%E7%90%86/">打包 AssetBundle 的基础规则整理</a></p><p><a href="/2022/11/18/StringBuilder%E6%89%A9%E5%AE%B9%E8%A7%84%E5%88%99%E7%A0%94%E7%A9%B6/">StringBuilder 扩容规则研究</a></p><p><a href="/2022/11/17/%E6%B5%8B%E8%AF%95%E6%89%8B%E5%8A%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">简单测试手动垃圾回收</a></p></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://github.com/CWHISME" target="_blank"><i class="fa fa-github"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="mailto:cwhisme@126.com" target="_blank"><i class="fa fa-envelope"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div></div><div class="f6 f5-ns center tc white pt5 fw3">Copyright © 2021 | Design & Hexo <a class="link dim white" target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-anodyne/">Jonathan Klughertz</a> | Modify By CWHISME</div></div></div></body></html>