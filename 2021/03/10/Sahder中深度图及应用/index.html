<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="CWHISME" href="https://wangjiaying.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="CWHISME" href="https://wangjiaying.top/atom.xml"><link rel="alternate" type="application/json" title="CWHISME" href="https://wangjiaying.top/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Unity3D,Shader"><link rel="canonical" href="https://wangjiaying.top/2021/03/10/Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8/"><title>Unity3D 中 Sahder 深度图及应用 - 图形学 - Unity3D | Jiaying's Note = CWHISME = 人不能没有梦想，也要有足够的敬畏</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Unity3D 中 Sahder 深度图及应用</h1><div class="meta"><span class="item" title="创建时间：2021-03-10 00:00:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2021-03-10T00:00:00+08:00">2021-03-10</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>4.3k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>4 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Jiaying's Note</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="/images/coverimages/large/acg40.webp"></li><li class="item" data-background-image="/images/coverimages/large/6833939bly1giclflwv2aj20zk0m84qp.webp"></li><li class="item" data-background-image="/images/coverimages/large/101754956_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/b809ff629a1d90e78bdb611156b6d413_2_2_art.webp"></li><li class="item" data-background-image="/images/coverimages/large/83708125_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/81943456_p0.webp"></li></ul></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Unity3D/" itemprop="item" rel="index" title="分类于 Unity3D"><span itemprop="name">Unity3D</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Unity3D/%E5%9B%BE%E5%BD%A2%E5%AD%A6/" itemprop="item" rel="index" title="分类于 图形学"><span itemprop="name">图形学</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://wangjiaying.top/2021/03/10/Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/../img/avator"><meta itemprop="name" content="WangJiaYing"><meta itemprop="description" content="人不能没有梦想，也要有足够的敬畏, 己所不欲，勿施于人"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CWHISME"></span><div class="body md" itemprop="articleBody"><p>关于 Sahder 中的深度图，其应用方式有很多，最常见的例如 科幻游戏中扫描线、水的 Shader、透明物体相交、屏幕后期处理的描边等。<br>主要就是因为在能够获得场景深度值之后，可以有许多操作空间。</p><h2 id="前言"><a class="anchor" href="#前言">#</a> 前言</h2><p>这篇文章，其实在之前整理『Unity3DSahder 关键字』及『Sahder 内置函数』的时候就在想写一下了。<br>不过在那之后，有几个原因导致一直没有动手：</p><ul><li>感觉只是个小东西，复杂之处在于用它来实现的各种后期效果；</li><li>虽然知道原理，但自己动手搞了搞之后，感觉理解起来有点困惑，这样就更不好说写什么了；</li><li>网上相关文章也挺多；<br>另外也有点其他事情耽搁了。</li></ul><p>不过后面考虑了下，不写写加深理解，总结实践下，那后面再遗忘可就真没收获了。<br>因此在这里，我会简单总结一下深度图分别在屏幕后期处理及单个物体 Shader 中的用法及作用。</p><h2 id="获取深度图"><a class="anchor" href="#获取深度图">#</a> 获取深度图</h2><p>在获取深度值方面，主要有两种方式：</p><ol><li>通过获取整个屏幕深度图</li><li>在单个物体特殊应用时，获取自身深度值</li></ol><p>在 Unity 中，引擎是直接提供了屏幕深度图的，使用方式也很简单：在 Shader 中声明 <code>sampler2D _CameraDepthTexture;</code> 变量即可，运行时 Unity 会自动为其赋值。<br>然后通过纹理采样函数，即可获取到指定 屏幕坐标 的深度值信息。<br>注意采样到的深度值，并非线性 [0,1] 深度值，可使用 Unity 提供的函数 Linear01Depth 转化。</p><p><font color="red">注：仅 “不透明” 对象（这些对象的材质和着色器设置为使用小于等于 2500 的渲染队列）会自动被渲染到深度纹理中</font></p><p>另外在这里还需要注意两点：屏幕后期处理 Shader 与物体自身 Sahder 采样的差异。</p><h3 id="屏幕后处理对深度图采样"><a class="anchor" href="#屏幕后处理对深度图采样">#</a> 屏幕后处理对深度图采样</h3><p>屏幕后期处理 Sahder 采样方式比较简单，直接将 i.uv 传入采样函数，返回的即是屏幕对应位置的深度值。</p><p>片元处理函数：</p><pre><code>float depth = Linear01Depth(tex2D(_CameraDepthTexture, i.uv).x);
</code></pre><h3 id="物体对屏幕深度值采样"><a class="anchor" href="#物体对屏幕深度值采样">#</a> 物体对屏幕深度值采样</h3><p>不过若使用者是某个物体的 Sahder，那么就不能直接通过 uv 去采用深度了；这也是理所当然，物体 uv 跟屏幕坐标可没有半分关系。<br>因此需要计算出顶点所在的屏幕空间坐标，然后将屏幕空间坐标当做 uv 对深度图进行采样。</p><p>Unity 同样提供了对应函数 <code>ComputeScreenPos(x)</code> ，其中 x 是投影空间坐标。<br>在顶点处理函数传入片元数据结构体中，定义一个四维变量，调用该方法即可获取屏幕坐标。</p><pre><code> o.screenPos=ComputeScreenPos(o.vertex);
</code></pre><p>然后在片元处理函数中，进行纹理采样。<br>注意此处是使用 tex2Dproj 采样。</p><pre><code>float sceneZ = tex2Dproj(_CameraDepthTexture,i.screenPos).x;
</code></pre><p>或者使用 tex2D，手动除以 w 分量亦可：<br>(注：原因是 uv 采样值范围是 [0,1]，因此计算出来的屏幕坐标需除以 w 分量映射至 [0,1] 区间)</p><pre><code>float sceneZ = tex2D(_CameraDepthTexture,i.screenPos.xy/i.screenPos.w).x;
</code></pre><p>直接将采样的深度值作为颜色输出效果：</p><p><img data-src="/blogimages/2021/2021-03-10-Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8_1.png" alt="物体采样(左)后处理屏幕采样(右)"><br>(物体采样 (左) 后处理屏幕采样 (右))</p><h2 id="屏幕后处理对深度值的应用"><a class="anchor" href="#屏幕后处理对深度值的应用">#</a> 屏幕后处理对深度值的应用</h2><p>关于屏幕后处理对深度图的应用，最简单的，大约要数 “扫描线” 这种了。<br>单纯地对比当前深度值及距离，就可以做出一个效果，网络上大多数关于深度图的文章，似乎也是第一个就在讲这个。</p><p>因此，秉着从简单开始原则，我也来一份。</p><p>首先，为了简单起见，这里就不使用其它什么额外效果，直接定义两个所需的基础变量：</p><ul><li>_Depth 作为当前深度距离</li><li>_Width 作为扫描线的宽度</li></ul><pre><code>_Width(&quot;Width&quot;,Float) = 0.1
_Depth(&quot;Depth&quot;,Range(0,1)) = 0.1
</code></pre><p>然后，在片元处理函数中，分别采样屏幕原图和深度图。<br>这时候就可以通过 _Depth 参数 和深度图中的数值进行对比，计算结果。</p><p>判断标准是什么？</p><ul><li>深度值小于 _Depth</li><li>深度值大于 _Depth-_Width 形成宽度<br>在这个区间内，可以形成一条宽度 _Width 的横线</li></ul><p>如下代码所示：</p><pre><code>//采样屏幕原图
float4 col = tex2D(_MainTex, i.uv);
//采样深度图
float depth = Linear01Depth(tex2D(_CameraDepthTexture, i.uv).x);
float distance = _Depth;
//判断深度值是否处于当前设置的区间内
if (depth &lt; distance &amp;&amp; depth&gt; distance - _Width) &#123;
	return float4(1, 0, 0, 1)+col;
&#125;
return col;
</code></pre><p><img data-src="/blogimages/2021/2021-03-10-Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8_2.gif" alt="最基础的效果"><br>(最基础的效果)</p><p>在这块代码中，判断当深度值处于当前设置区间内，则直接将红色与当前颜色融合，否则返回当前颜色。很简单的一个逻辑。</p><p>如果觉得这条横线的边太硬，想稍微加点效果的话，还可以根据当前颜色深度所处宽度比例，作边缘柔化处理：</p><pre><code>float diff = 1 - (distance - depth) / _Width;
return float4(1, 0, 0, 1)*diff+col;
</code></pre><p>由于上面是深度位于 distance - _Width 区间才会进来，所以 distance - depth 取值范围为 [0,_Width]。<br>因此 distance - depth 便是当前所处区间的位置，除以宽度，得出当前所处位置的比例。根据比例逐步提高线条颜色值，可以形成一个简易的柔化效果。</p><p><img data-src="/blogimages/2021/2021-03-10-Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8_3.png" alt="加柔边效果"><br>(加柔边效果)</p><p>屏幕后期处理中，上述只是最简单和基础的一个应用，深度图的作用还有做屏幕描边啊、模糊，做雾效等等，在此就不多说了。</p><h2 id="物体shader对深度值的应用"><a class="anchor" href="#物体shader对深度值的应用">#</a> 物体 Shader 对深度值的应用</h2><p>在物体 Sahder 中，如果需要获取深度图，那么一般来说，自身深度都是不写入深度图的，ZWrite 通常为 <code>ZWrite Off</code> 。</p><p>因此主要有两个操作：</p><ul><li>计算自身深度值</li><li>采样自身位置原本深度值</li></ul><p>然后通过两者相差，进行深度比较执行其它逻辑。<br>最常见的例如水的 Shader，在靠近岸边的时候波浪、渐变效果，物体相交检测等。应用方面，这里主要就说一下物体相交检测的效果。</p><p>为了计算自身深度，可以直接使用 Unity 提供函数 COMPUTE_EYEDEPTH (x)，需要在顶点处理函数中调用，返回当前顶点深度值。</p><p>为了采样自身原本位置深度值，需要计算出当前顶点对应屏幕坐标，然后对深度图进行采样。</p><pre><code>v2f:
	float4 screenPos: TEXCOORD3;

vert:
	o.screenPos = ComputeScreenPos(o.vertex);
	COMPUTE_EYEDEPTH(o.screenPos.z);
</code></pre><p>由于计算出来的屏幕坐标，z 值实际上是没用的 (投影纹理查询只用到 xy/w)，因此可以直接将自己的深度值存放至 screenPos 的 z 值中，传入片元处理函数。</p><p>来到片元处理函数后，采样深度图中的深度值，并将其与物体当前深度值进行对比，直接输出，可得到如下效果：</p><p><img data-src="/blogimages/2021/2021-03-10-Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8_4.png" alt="效果"></p><p>代码如下：</p><pre><code>//场景深度
float sceneZ = LinearEyeDepth(tex2Dproj(_CameraDepthTexture,i.screenPos).x);
//自身深度
float selfZ = (i.screenPos.z);
//取得差值
float diff =  (sceneZ-selfZ );
//输出差值
return float4(diff, diff, diff,1);
</code></pre><p>我们需要实现一个 相交描边 的效果，那么可以定义一个描边强度值 <code>_OutLineValue(&quot;RimValue&quot;, Range(0,1)) = 0.1</code><br>大于该值输出描边颜色，否则可以输出黑色。<br>将直接返回深度差值修改为：</p><pre><code>return float4(step(diff, _OutLineValue) , 0, 0, 0.5);
</code></pre><p>step 为 shder 内置函数，step (diff, _OutLineValue) 表示，当 diff 小于_OutLineValue 时，返回 1，diff 大于_OutLineValue 时，返回 0。<br>直接当做 R 通道颜色放进去，可以方便低实现：深度值低于_OutLineValue 显示红色描边 的需求。</p><p><img data-src="/blogimages/2021/2021-03-10-Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8_5.png" alt="效果"></p><p>如此，最简单的一个 相交描边 效果就实现了，代码很简单，所以效果也很简陋。</p><p>为了优化点显示的话，可以加一点其它效果：</p><pre><code>//场景深度
float sceneZ = LinearEyeDepth(tex2Dproj(_CameraDepthTexture,i.screenPos).x);
//自身深度
float selfZ = (i.screenPos.z);
//取得差值
float diff =  (sceneZ-selfZ);
//计算相交的描边强度
float outLineStrenth =1- saturate(diff / _OutLineValue);
//计算视线夹角，实现轮廓高亮
float rimStrenth=1-abs(dot(i.normal, i.viewDir))*_RimValue;
return float4(0,0,0,0.5)+float4(1,0,0,0)*max(outLineStrenth, rimStrenth);
</code></pre><p>因为这里的物体是透明且双面显示，因此需要处理法线与视线为负的情况，这里直接将点乘结果转化为绝对值的正数。<br>最终返回值为半透明黑色叠加相交描边或轮廓颜色：在这里取两者最大值，可以保证相交和轮廓因为视角原因叠在一块的时候，可以优先展示程度更深的一方，效果更好。</p><p>另外外边缘轮廓还可以直接使用菲涅尔效果展示 (比上面单纯视线和法线夹角好用，当然计算也稍微多一点)。</p><p>一般游戏中，使用的简化版菲涅尔公式为：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>f</mi><mi>r</mi><mi>e</mi><mi>s</mi><mi>n</mi><mi>e</mi><mi>l</mi><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mo stretchy="false">(</mo><mi>N</mi><mo>⋅</mo><mi>V</mi><mo stretchy="false">)</mo><msup><mo stretchy="false">)</mo><mn>5</mn></msup><mo>∗</mo><mtext>强度</mtext></mrow><annotation encoding="application/x-tex">fresnel=(1-(N \cdot V))^5*强度</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord mathnormal">e</span><span class="mord mathnormal">s</span><span class="mord mathnormal">n</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.10903em">N</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.1141079999999999em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.22222em">V</span><span class="mclose">)</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8641079999999999em"><span style="top:-3.113em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">5</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord cjk_fallback">强</span><span class="mord cjk_fallback">度</span></span></span></span></span></p><p>代码可修改为：</p><pre><code>float rim=pow(1-abs(dot(i.normal, i.viewDir)), 5)*_RimValue;
</code></pre><p>当然，其中 5 这个定量也可以修改为变量，已进行更细致的效果调整。</p><p><img data-src="/blogimages/2021/2021-03-10-Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8_6.png" alt="效果 直接轮廓高亮(左) 菲涅尔(右)"><br>(效果 直接轮廓高亮 (左) 菲涅尔 (右))</p><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p>以上便是深度图最简答的两个不同应用。<br>这次也是一边实践一边 Bing 一边写，花了两天多时间，总算收尾了。<br>怎么说呢，这一趟下来，还是有收获的。之前虽然知道大概怎么做，但实际理解起来还是有点糊的，因为自己不理解的也不敢直接写，所以从易到难一遍想一边慢慢再实现一遍，至少很多之前不太理解的地方也算想通了。</p><p>后边除非许久不再研究这一块，就算忘了，看看自己写的文章，应该也能很快拾起来吧。</p><div class="tags"><a href="/tags/Unity3D/" rel="tag"><i class="ic i-tag"></i> Unity3D</a> <a href="/tags/Shader/" rel="tag"><i class="ic i-tag"></i> Shader</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-06-04 19:42:34" itemprop="dateModified" datetime="2023-06-04T19:42:34+08:00">2023-06-04</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>WangJiaYing <i class="ic i-at"><em>@</em></i>CWHISME</li><li class="link"><strong>本文链接：</strong> <a href="https://wangjiaying.top/2021/03/10/Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8/" title="Unity3D 中 Sahder 深度图及应用">https://wangjiaying.top/2021/03/10/Sahder中深度图及应用/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2021/03/09/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%8A%A0%E5%AF%86/" itemprop="url" rel="prev" data-background-image="&#x2F;images&#x2F;coverimages&#x2F;large&#x2F;104001022_p0.webp" title="网络协议加密"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 理论研究</span><h3>网络协议加密</h3></a></div><div class="item right"><a href="/2021/03/25/%E5%85%B3%E4%BA%8ESynchronizationContext/" itemprop="url" rel="next" data-background-image="&#x2F;images&#x2F;coverimages&#x2F;large&#x2F;5A370CF6-14C1-4CA4-8EC9-0426E19DA8DB.webp" title="关于SynchronizationContext的使用"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 理论研究</span><h3>关于SynchronizationContext的使用</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B7%B1%E5%BA%A6%E5%9B%BE"><span class="toc-number">2.</span> <span class="toc-text">获取深度图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%8F%E5%B9%95%E5%90%8E%E5%A4%84%E7%90%86%E5%AF%B9%E6%B7%B1%E5%BA%A6%E5%9B%BE%E9%87%87%E6%A0%B7"><span class="toc-number">2.1.</span> <span class="toc-text">屏幕后处理对深度图采样</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%A9%E4%BD%93%E5%AF%B9%E5%B1%8F%E5%B9%95%E6%B7%B1%E5%BA%A6%E5%80%BC%E9%87%87%E6%A0%B7"><span class="toc-number">2.2.</span> <span class="toc-text">物体对屏幕深度值采样</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%8F%E5%B9%95%E5%90%8E%E5%A4%84%E7%90%86%E5%AF%B9%E6%B7%B1%E5%BA%A6%E5%80%BC%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">屏幕后处理对深度值的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%89%A9%E4%BD%93shader%E5%AF%B9%E6%B7%B1%E5%BA%A6%E5%80%BC%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">物体 Shader 对深度值的应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">总结</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2016/05/31/Unity3D%E4%B8%ADShader%E7%9A%84%E9%98%B4%E5%BD%B1/" rel="bookmark" title="Unity3D中Shader的阴影">Unity3D中Shader的阴影</a></li><li><a href="/2016/11/04/Shader-%E5%83%8F%E7%B4%A0%E6%89%AD%E6%9B%B2%E6%95%88%E6%9E%9C/" rel="bookmark" title="[Shader]像素扭曲效果">[Shader]像素扭曲效果</a></li><li><a href="/2016/11/21/Unity3D-Tri-planar-Terrain/" rel="bookmark" title="Unity3D Tri-planar Terrain">Unity3D Tri-planar Terrain</a></li><li><a href="/2016/12/15/Tri-planar-Terrain-%E4%BA%8C-%E9%94%99%E8%AF%AF%E4%BF%AE%E6%AD%A3/" rel="bookmark" title="Tri-planar Terrain (二) 错误修正">Tri-planar Terrain (二) 错误修正</a></li><li><a href="/2021/01/26/Unity3DSahder%E5%85%B3%E9%94%AE%E5%AD%97/" rel="bookmark" title="Unity3D Sahder 关键字">Unity3D Sahder 关键字</a></li><li><a href="/2021/02/02/Sahder%E5%86%85%E7%BD%AE%E5%87%BD%E6%95%B0/" rel="bookmark" title="Sahder内置函数">Sahder内置函数</a></li><li class="active"><a href="/2021/03/10/Sahder%E4%B8%AD%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%8F%8A%E5%BA%94%E7%94%A8/" rel="bookmark" title="Unity3D中Sahder深度图及应用">Unity3D中Sahder深度图及应用</a></li><li><a href="/2022/12/06/Unity%E7%9A%84%E9%98%B4%E5%BD%B1%E4%B8%8E%E5%85%89%E7%85%A7%E7%83%98%E7%84%99/" rel="bookmark" title="Unity 的阴影与光照烘焙">Unity 的阴影与光照烘焙</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="WangJiaYing" data-src="/images/../img/avator"><p class="name" itemprop="name">CWHISME</p><div class="description" itemprop="description">己所不欲，勿施于人</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">123</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">22</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">32</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N3aGlzbWU=" title="https:&#x2F;&#x2F;github.com&#x2F;cwhisme"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jd2hpc21lLTMzL3Bvc3Rz" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;cwhisme-33&#x2F;posts"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmN3aGlzbWVAMTI2LmNvbQ==" title="mailto:cwhisme@126.com"><i class="ic i-envelope"></i></span> <a href="/atom.xml" title="&#x2F;atom.xml" class="item feedback"><i class="ic i-heart"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/statistics/" rel="section"><i class="ic i-clock"></i>统计</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2021/03/09/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%8A%A0%E5%AF%86/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2021/03/25/%E5%85%B3%E4%BA%8ESynchronizationContext/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/C/" title="分类于 C#">C#</a></div><span><a href="/2023/04/14/%E5%AF%B9%E5%88%97%E8%A1%A8%E5%AE%B9%E5%99%A8%E4%B8%AD%E5%80%BC%E7%B1%BB%E5%9E%8B%E5%BC%95%E7%94%A8%E4%BC%A0%E5%8F%82%E7%9A%84%E4%B8%80%E7%82%B9%E6%B5%8B%E8%AF%95/" title="对列表容器中值类型引用传参的一点测试">对列表容器中值类型引用传参的一点测试</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%8D%9A%E5%AE%A2/" title="分类于 博客">博客</a></div><span><a href="/2022/12/19/%E5%85%B3%E4%BA%8E%E6%88%91%E5%8F%88%E6%8A%8A%E5%8D%9A%E5%AE%A2%E4%B8%BB%E9%A2%98%E6%8D%A2%E6%88%90Shoka%E7%9A%84%E4%BA%8B/" title="关于我又把博客主题换成 Shoka 的事">关于我又把博客主题换成 Shoka 的事</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/" title="分类于 阅读笔记">阅读笔记</a> <i class="ic i-angle-right"></i> <a href="/categories/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0/C/" title="分类于 C#">C#</a></div><span><a href="/2023/04/06/ClrVirCS%E7%AC%94%E8%AE%B0-%E4%B8%8A/" title="《CLR VIR C#》笔记(上)">《CLR VIR C#》笔记(上)</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment count_3"></ul></div></div><div class="status"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">WangJiaYing @ Jiaying's Note</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">728k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">11:02</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NXSElTTUUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2021/03/10/Sahder中深度图及应用/",favicon:{show:"（●´3｀●）",hide:"(´Д｀)"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,copy_tex:!0,katex:!0,fancybox:!0,justifiedGallery:!0,jquery:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script><script src="https://cdn.staticfile.org/pjax/0.2.8/pjax.min.js"></script><script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script><script src="https://cdn.staticfile.org/algoliasearch/4.17.0/algoliasearch-lite.umd.js"></script><script src="https://cdn.staticfile.org/instantsearch.js/4.54.1/instantsearch.production.min.js"></script><script src="https://cdn.staticfile.org/lozad.js/1.16.0/lozad.min.js"></script><script src="https://cdn.staticfile.org/quicklink/2.3.0/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/js/DateTimeAfeterCalc.js" async></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js" async></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?62952472c154f9131a14a4ab57bfefec";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>