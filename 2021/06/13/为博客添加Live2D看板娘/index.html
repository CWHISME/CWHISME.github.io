<!DOCTYPE html><meta name="viewport" content="height=device-height,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=0"><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="cwhisme"><meta name="author" content="CWHISME"><meta property="og:title" content="为博客添加Live2D看板娘折腾的那些事"><meta property="og:description" content="cwhisme"><meta property="og:site_name" content="WangJiaYing"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><title>为博客添加Live2D看板娘折腾的那些事 - WangJiaYing</title><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/DateTimeAfeterCalc.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/particles-bg.js"></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/animejs@latest"></script><script type="text/javascript" src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/js/script.js"></script><link href="https://fastly.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/css/style.css"><link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/tachyons@4.12.0/css/tachyons.min.css"><meta name="generator" content="Hexo 5.4.2"><link rel="alternate" href="/atom.xml" title="WangJiaYing" type="application/atom+xml">
</head><body><canvas id="hackEffectCanvas" style="position:fixed;z-index:-1;pointer-events:none"></canvas><canvas class="fireworks" style="position:fixed;z-index:10;pointer-events:none"></canvas><div class="w-100 bg-1 ph5-ns ph3 text-light"><nav class="db dt-l w-100 mw8 center border-box pv3"><a class="db dtc-l v-mid link dim w-100 w-25-l tc tl-l mb2 mb0-l white" href="/" title="WangJiaYing"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/logo.svg" class="dib h3" alt="WangJiaYing"></a><div class="db dtc-l v-mid w-100 w-75-l tc tr-l"><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">Home </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/archives" title="Archives">Archives </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/tags" title="Tags">Tags </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/categories" title="Categories">Categories </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/bookmark" title="Bookmark">Bookmark </a><a class="link dim f6 f5-l dib mr3 mr4-l white" href="/about" title="About">About</a></div></nav><div class="w-100 mw8 center vh-40 dt"><div class="dtc v-mid white"><h1 class="f1-l f2-m tc tc-m tl-ns">为博客添加Live2D看板娘折腾的那些事</h1><p class="f4 fw3 pab-100px tc tc-m tl-ns"><i class="fa fa-calendar-check-o" aria-hidden="true"></i> 2021-06-13&nbsp&nbsp <i class="fa fa-clock-o" aria-hidden="true"></i> <span id="dateTimeAfter">2021-06-13</span></p></div></div><div class="relative w-100 mw8 center white dn dn-m db-ns"><i class="header-icon fa fa-gift"></i></div></div><div class="w-100 ph2 ph4-m ph5-l mv5 mv6-l"><div class="content"><div class="mw8 center"><div class="cf"><div class="fl w-100 w-70-l mw7 left fw3 lh-copy pr4-ns pr0-m post-content"><p>之前偶尔就会在别人的博客上看到Live2D看板娘效果，就…有点眼馋了。</p><p>于是就想：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/expression/getforme.jpg" alt="exp"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本来昨天就在想，将 live2D 相关的东西都弄完，然后将本篇文章写完，以及再写个『年中』总结。</p><p>结果果然是人算不如情况，预期总是与实际有所差异，昨天整了一天live2D。<br>主要是到处找模型，然后挑选看得上眼的，以及写些自定义修改代码花的时间有点长。<br>另外为了方便本地预览模型，还整了两个 Python 脚本来辅助，一个用于批量重名名，将入口json文件重命名为 index.json，另一个用于批量替换预览：点一下控制窗口，然后刷一下页面就切到下一个模型这种。</p><p>今天又加了点新功能，修了点昨天没注意到的 Bug，然后修修改改时间又跑了，今天最多把本篇博客写完就差不多了(或者可能也写不完，得等明天补充了)。<br>总结呢怎么着也还是得拖到明天去，毕竟除了本篇博客之外，新下载了十几个G的live2D模型，还等着我弄到看板娘上去看呢。</p><h2 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h2><p>如果按照 Hexo 来讲的话，大概有三种方式：</p><ol><li>使用Hexo插件，直接 <code>npm install --save hexo-helper-live2d</code> 安装Hexo插件，Github地址为 <a target="_blank" rel="noopener" href="https://github.com/EYHN/hexo-helper-live2d/">hexo-helper-live2d</a></li><li>使用第三方做好的Live2D代码，然后作自定义修改</li><li>拉取官方SDK，自己撸一个</li></ol><p>个人采用了第二种方式，使用 <a target="_blank" rel="noopener" href="https://github.com/stevenjoezhang/live2d-widget">live2d-widget</a>，并在此基础上作自定义修改。</p><p>将其从Github上拉下来，放在自己博客的 source 目录下，然后在 head.ejs 处引用 autoload.js 即可。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 自定义看板娘 --&gt;</span><br><span class="line">&lt;% if (theme.live2d.enable)&#123; %&gt;</span><br><span class="line">&lt;script src=&quot;/live2d-widget/autoload.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure><p>当然，这是最基础和简单的做法，单纯这样，确实可以弄出看板娘，但是模型之类的全都是示例库的。</p><p>此时想要做到更换自定义的看板娘，有三种做法：</p><ol><li>按照官方文档自己搭建一个服务器</li><li>直接将模型放在 Hexo source 目录加载</li><li>按照说明文档 fork 示例库，或者自己建立一个模型库，然后修改 model_list.json 列表</li></ol><p>第一种就不考虑了，没服务器，而且弄起来也挺麻烦。<br>第二种会增加博客项目本身大小，每次 deploy 可都是一份消耗，所以也不考虑。</p><p>因此个人开始选择了第一种。</p><p>分别 fork 以下两个库：</p><ol><li><a target="_blank" rel="noopener" href="https://github.com/stevenjoezhang/live2d-widget">live2d-widget</a></li><li><a target="_blank" rel="noopener" href="https://github.com/fghrsh/live2d_api">live2d_api</a></li></ol><p>注：如果觉得这样比较麻烦，也可直接拉取 live2d-widget 库，然后将其文件复制到 Hexo source 目录使用。</p><p>fork 之后，发现就算修改了 model_list.json，但是使用 jsdeliver 拉到的 model_list.json 模型配置表还是旧的。</p><p>可能是因为 jsdeliver 缓存原因，于是改成支持本地加载配置，然后整理模型。</p><p>加载模型列表的代码改在了 autoload.js 初始化的地方，可以直接配置绝对路径，也可以配置相对路径：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">initWidget(&#123;</span><br><span class="line">    <span class="attr">waifuPath</span>: live2d_path + <span class="string">&quot;waifu-tips.json&quot;</span>,</span><br><span class="line">    <span class="comment">//模型列表配置路径，如果不配置则默认为 cdnPath 路径下同名文件</span></span><br><span class="line">    <span class="attr">modelListPath</span>: live2d_path + <span class="string">&quot;model_list.json&quot;</span>,</span><br><span class="line">    <span class="comment">//apiPath: &quot;https://live2d.fghrsh.net/api/&quot;,</span></span><br><span class="line">    <span class="comment">//live2d模型仓库地址</span></span><br><span class="line">    <span class="attr">cdnPath</span>: <span class="string">&quot;https://cdn.jsdelivr.net/gh/CWHISME/live2d_api@master/&quot;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>效果如下：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_Exp_1.png" alt="live2D"></p><h2 id="关于点击反馈"><a href="#关于点击反馈" class="headerlink" title="关于点击反馈"></a>关于点击反馈</h2><h3 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h3><p>由于网上搜集模型，多数都是提取来的。其配置的 json 有时候默认选项可能无法触发反馈。</p><p>辨别方法很简单：当你发现配置中有 flick_head、tap_body 相关 motion 配置，但是点击脑袋或者身体都没反应的话，就说明模型默认不支持。</p><p>此时如果想要的话，就需要自己手动设置对应点击区域及其动作了。</p><p>如下所示：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&quot;hit_areas_custom&quot;:&#123;</span><br><span class="line">    &quot;head_x&quot;:[-0.3, 0.8],</span><br><span class="line">    &quot;head_y&quot;:[-0.04, 0.43],</span><br><span class="line">    &quot;body_x&quot;:[-0.4, 0.29],</span><br><span class="line">    &quot;body_y&quot;:[0.17, -0.38]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该配置代表自定义了两个点击区域 『头』 『身体』，当点击对应区域时，分别会触发 “flick_head”、“tap_body” 的 Motion 事件</p><p>其中 hit_areas_custom 字段的 head_x 和 body_x 定义了头部和身体的 HIT_AREA 的左上角的坐标，head_y 和b ody_y 定义了右下角的坐标。</p><p>获取坐标的方式可以通过修改 live2d.min.js 中 DEBUG_LOG:!0 实现。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_live2DdebugLog.png" alt="live2D"></p><p>注：如果想直接通过明文ID取区域，也可以在 <code>i.prototype.getDrawDataIndex</code> 处打断点，找明文ID。</p><p>内置支持的 Motion 字段有：</p><ul><li>flick_head：点击脑袋触发</li><li>tap_body：点击身体触发</li><li>sleepy: 50000毫秒后自动播放，index.json 没配置的话，会报错</li></ul><p>另外还有『Tap face』会触发播放表情，不过网上下载的模型，基本上都是没有表情的。因此个人对 live2D.min.js 做了点修改：当没有表情时，点击脑袋触发 “flick_head” motion 事件。<br>另外修改了播放的判断代码，不会由于 motion 优先级而导致后续点击被忽略。</p><p>另外经过对 live2D.min.js 代码的查询，目前这个插件用到的 live2d sdk,好像就支持这么三个触发 motion 事件了。互动事件就两个，一个点击身体，一个点击脑袋。</p><h3 id="音效"><a href="#音效" class="headerlink" title="音效"></a>音效</h3><p>可以参考 nepnep 模型，在点击触发事件中，添加 sound 字段即可。</p><h2 id="自定义修改"><a href="#自定义修改" class="headerlink" title="自定义修改"></a>自定义修改</h2><p>如果有对修改版更有兴趣的，也可以 fork 我修改后的库。</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/CWHISME/live2d-widget">live2d-widget</a></li><li><a target="_blank" rel="noopener" href="https://github.com/CWHISME/live2d_api">live2d_api</a></li></ul><p>其中 model_list.json 增加 defaultModelInfo、sizeZoomList 字段(还有个 backup 字段可以忽略，没有实际作用)</p><ul><li>defaultModelInfo：用于配置默认的模型路径</li><li>sizeZoomList：配置模型可以放大的大小列表</li></ul><hr><p>具体还修改了些啥，看了下记录，大概修改有：</p><ul><li>支持直接配置本地模型表</li><li>增加模型表初始化模型配置</li><li>优化随机模型方式，避免反复随机到同一模型，在同一角色没有多个模型时，隐藏换装按钮</li><li>增加放大live2d模型展示区域的功能</li><li>增加Python小工具方便预览</li></ul><h3 id="Python小工具"><a href="#Python小工具" class="headerlink" title="Python小工具"></a>Python小工具</h3><ul><li>ModifyFileName.py: 用于一键重命名，将网上下载的 <em>.model.json</em> 格式后缀的入口文件重命名为 <em>index.json</em></li><li>ModifyFileStr.py：用于更换模型，递归执行，将指定目录下所有存在<strong>index.json</strong>文件的入口进行依次替换入预览代码，回车键更换。</li></ul><p>注：后续 ModifyFileStr.py 经过修改后，有预览时选择备份则同时修改model.json的功能，如果使用ModifyFileStr那么ModifyFileName就属于可选项了。</p><p>使用方法是：</p><p>首先反注释 waifu-tips.js 中代码 <code>loadlive2d(&quot;live2d&quot;, `/@live2D@/`);</code>，并注释下方正常加载代码，然后修改ModifyFileStr.py中的开头路径配置即可。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要修改脚本路径</span></span><br><span class="line">jsfilePath = <span class="string">r&quot;F:/Hexo/HexoBlog/Hexo/source/live2d-widget/waifu-tips.js&quot;</span></span><br><span class="line"><span class="comment"># 模型路径</span></span><br><span class="line">live2DPath = <span class="string">r&quot;F:/Hexo/live2dModels/Live2d-model/&quot;</span></span><br><span class="line"><span class="comment"># 如果更换模型时，输入了“1”，则会同时将当前模型复制到此目录</span></span><br><span class="line">live2DBackupPath = <span class="string">r&quot;F:/Hexo/live2dModels/fav/&quot;</span></span><br><span class="line"><span class="comment">#模型的网络路径---或者如果是直接拖到Hexo/Source目录的话，就是相对路径，如“/live2D/”</span></span><br><span class="line">rootDir = <span class="string">&quot;/live2D/&quot;</span></span><br><span class="line"><span class="comment"># 标记符号</span></span><br><span class="line">defaultName = <span class="string">&quot;/@live2D@/&quot;</span></span><br></pre></td></tr></table></figure><p>其中：</p><ul><li>配置相对路径：需要将模型放 source 目录</li><li>绝对路径：一个绝对的网络路径，如从 jsdeliver 拉取的</li></ul><p>然后执行py脚本，按回车会照顺序切换模型。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_py1.png" alt="live2D模型库"></p><h4 id="搭建本地文件服务测试"><a href="#搭建本地文件服务测试" class="headerlink" title="搭建本地文件服务测试"></a>搭建本地文件服务测试</h4><p>注1：可以使用 <a href="www.rejetto.com/hfs">HFS</a> 搭建本地文件服务，这样就不用把模型拖进Hexo sourse目录了，不然可想而知，十几个G大小的模型，Hexo铁定处理不过来的。HFS添加好对应目录后，网页js就可以直接访问了，非常方便。<br>注2：实际试过HFS之后，发现会有报跨域访问调用问题…</p><p>因为跨域访问问题，因此文件服务器还是换成 <a target="_blank" rel="noopener" href="https://nginx.org/">Nginx</a> 了。</p><p>在 nginx.conf 配置 server 字段中添加一列新的 location 配置即可：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">location /Live2d-model &#123;</span><br><span class="line">    # 模型绝对路径</span><br><span class="line">    alias   F:/Hexo/live2dModels/Live2d-model/;</span><br><span class="line">    allow all;</span><br><span class="line">    autoindex on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然，Nginx 如果用只是这样使用默认配置依然还是会有跨域访问问题，因此配置表中还需要加一行：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location /Live2d-model &#123;</span><br><span class="line">    # 模型绝对路径</span><br><span class="line">    alias   F:/Hexo/live2dModels/Live2d-model/;</span><br><span class="line">    allow all;</span><br><span class="line">    autoindex on;</span><br><span class="line">    # 允许跨域访问</span><br><span class="line">    add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">    # 禁止缓存，避免本地有问题，修改之后无法即时刷新</span><br><span class="line">    add_header Cache-Control no-store;</span><br><span class="line">    add_header Pragma no-cache;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置完成之后，如果之前启动过 Nginx 服务，则需要使用 nginx -s reload 命令重新加载配置。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 重新加载配置</span><br><span class="line">nginx -s reload</span><br><span class="line"># 正常关闭</span><br><span class="line">nginx -s quit</span><br><span class="line"># 快速关闭服务</span><br><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure><p>然后 Python 代码中， rootDir 路径修改为 Nginx 访问路径：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 需要修改脚本路径</span></span><br><span class="line">jsfilePath = <span class="string">r&quot;F:/Hexo/HexoBlog/Hexo/source/live2d-widget/waifu-tips.js&quot;</span></span><br><span class="line"><span class="comment"># 模型路径</span></span><br><span class="line">live2DPath = <span class="string">r&quot;F:/Hexo/live2dModels/Live2d-model/&quot;</span></span><br><span class="line"><span class="comment"># 如果更换模型时，输入了“1”，则会同时将当前模型复制到此目录</span></span><br><span class="line">live2DBackupPath = <span class="string">r&quot;F:/Hexo/live2dModels/fav/&quot;</span></span><br><span class="line"><span class="comment"># 模型的网络路径---或者如果是直接拖到Hexo/Source目录的话，就是相对路径，如“/live2D/”</span></span><br><span class="line">rootDir = <span class="string">&quot;http://127.0.0.1/Live2d-model/&quot;</span></span><br><span class="line"><span class="comment"># 标记符号</span></span><br><span class="line">defaultName = <span class="string">&quot;/@live2D@/&quot;</span></span><br></pre></td></tr></table></figure><p>执行 Python 代码：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_py2.png" alt="live2D"></p><p>刷新页面，就可以看到可以正常访问，模型也加载出来了。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_Nginx.png" alt="live2D"></p><p>问题解决了之后，还是有点成就感的嘛。不过，等我过两天忘了就想不起来了。</p><h2 id="其它模型库"><a href="#其它模型库" class="headerlink" title="其它模型库"></a>其它模型库</h2><p>因为注意到点击网上找的模型的时候，有时候会报错，如下：</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_Error.png" alt="live2D"></p><p>然后就考虑是不是模型的问题，于是想到了昨天导出找模型找到的一个庞大无比的 <a target="_blank" rel="noopener" href="https://github.com/Eikanya/Live2d-model">live2D模型库</a>，到如今都还在维护。看日期前些天都在更新。</p><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_gitModel.png" alt="live2D"></p><p>昨天也是为感觉这库太大，暂且放弃了</p><p>然后呢，正好因为这仓库里边也有之前找的模型，于是今天想替换下来看看，结果分支不能单独拉，就全拉了…<br>整个模型库达到了十几个G！虽然readme写着有相关工具可以单独下载的，不过在我试图直接拉取的时候，github竟然达到了满速，十几M每秒？！<br>虽然凭借github都经常连不上这种经验感觉不对劲，不过既然速度这么快，于是放弃思考，就让它继续拉了。</p><p>所有可以想见，待会我还要筛模型，找好好康的，应该还需要不短的时间的了。</p><hr><p>都有报错，最后还是在 live2d.min.js 对应方法处加了个容错判断。</p><hr><p>另外这个模型库还有很多是moc3格式的，目前这个插件想要用的话，就得改使用的 live2d 渲染插件和代码了。比如同时支持两者模型，根据不同模型调用不同的渲染？不过moc的已经够用了。其他的模型暂时也不想看了，等以后什么时候想搞再说吧。</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="js修改css样式"><a href="#js修改css样式" class="headerlink" title="js修改css样式"></a>js修改css样式</h3><p>在使用js修改元素style的时候，必须符合元素原本规范，比如：设置元素的长宽。<br>之前我是这样用的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> panel = <span class="built_in">document</span>.getElementById(<span class="string">&quot;live2d&quot;</span>);</span><br><span class="line">panel.style.height = size;</span><br><span class="line">panel.style.width = size;</span><br></pre></td></tr></table></figure><p>结果一直不生效，调试又得出结论找到的元素也没问题，就很为难。<br>后边左思右想，各种赋值方法也试过，都没法改变，网上也搜索不出什么东西。</p><p>后边看着css代码发呆的时候，偶然注意到css代码赋值参数是有『px』后缀，于是抱着试一试的心态，结果成了！</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">zoomModelSize</span>(<span class="params">add = <span class="literal">false</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!modelList) <span class="keyword">await</span> loadModelList();</span><br><span class="line">    <span class="keyword">var</span> sizeZoomIndex = sessionStorage.getItem(<span class="string">&quot;sizeZoomIndex&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (add) &#123;</span><br><span class="line">        sizeZoomIndex++;</span><br><span class="line">        showMessage(<span class="string">&quot;好的啦 ~~~&quot;</span>, <span class="number">2000</span>, <span class="number">9</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sizeZoomIndex &gt;= modelList.sizeZoomList.length||!(<span class="keyword">typeof</span>(sizeZoomIndex) == <span class="string">&#x27;number&#x27;</span> &amp;&amp; !<span class="built_in">isNaN</span>(sizeZoomIndex)))</span><br><span class="line">        sizeZoomIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> outBoundSize = modelList.sizeZoomList[sizeZoomIndex] + <span class="number">35</span>;</span><br><span class="line">    <span class="keyword">if</span> (outBoundSize &gt; <span class="built_in">window</span>.innerHeight || outBoundSize &gt; <span class="built_in">window</span>.innerWidth) &#123;</span><br><span class="line">        sizeZoomIndex = <span class="number">0</span>;</span><br><span class="line">        showMessage(<span class="string">&quot;你的浏览器界面太小了，再大一点可就装不下啦 ~&quot;</span>, <span class="number">5000</span>, <span class="number">9</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> size = modelList.sizeZoomList[sizeZoomIndex]</span><br><span class="line">    <span class="keyword">var</span> panel = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#waifu #live2d&quot;</span>);</span><br><span class="line">    panel.style.height = size + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">    panel.style.width = size + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">    sessionStorage.setItem(<span class="string">&quot;sizeZoomIndex&quot;</span>, sizeZoomIndex);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个问题是在我修改这次博客使用到的live2d插件代码，准备加一个『循环放大/缩小』效果的时候发现的。<br>毕竟js这东西，以及网页这块，也都是个人在整自己博客的时候用到过，有问题就查文档或搜索。<br>大概因为这个问题是属于『常识』？碰到过的大概知道，js style会自动筛除不合法格式的代码，但是给个提示也好么，既没有报错，也不给提示，所说说这些弱类型语言有时候就让人喜欢不起来。</p><h3 id="vscode快捷键"><a href="#vscode快捷键" class="headerlink" title="vscode快捷键"></a>vscode快捷键</h3><p>Shift+Alt可以像Vs一样竖行选择。</p><h3 id="关于-js-获取移动端高宽"><a href="#关于-js-获取移动端高宽" class="headerlink" title="关于 js 获取移动端高宽"></a>关于 js 获取移动端高宽</h3><p>直接使用想要获取屏幕长宽使用 screen.width 或者获取浏览器长宽使用 window.innerWidth 貌似都无法获取到正确结果。</p><p>其中获取屏幕长宽 screen.width 可以通过在页面开始加上meta标志，使其在移动端也可以生效：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;height=device-height, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>而 window.innerWidth 在移动端好像是不行的。所以可以改用 document.body.clientWidth 获取浏览器长宽。</p><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_Exp_2.png" alt="live2D"><br><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/blogimages/2021/2021-6-13/2021-06-13-%E4%B8%BA%E5%8D%9A%E5%AE%A2%E6%B7%BB%E5%8A%A0Live2D%E7%9C%8B%E6%9D%BF%E5%A8%98_Exp_3.png" alt="live2D"></p><p>如同前言所说，开始本来只是打算用插件弄好就收工，计划的是端午节的第一天把live2D弄好，并且把本文写了，另外再写个『年中』总结。</p><p>结果后边为了测试网上找的模型，又写了两个Python小工具，大概就是递归查找模型，然后修改js读取代码处的加载路径。<br>最初也是采用将模型放在 source 目录，然后使用相对路径读取。</p><p>后面不是下载了一个超大型模型库么，十几个G，太大了，直接放 Hexo 里边，硬盘哗啦啦响，半天反应不过来。<br>于是又配置 nginx 文件服务，使得可以本地读取。</p><p>以及一些感觉想改的地方也想改改，搞着搞着，就在改改改这块儿一去不复返了。<br>今天已经是端午节第三天了，明天就又要上班了。端午节三天，花了可不少时间在这上边，本来计划的学习下 .NetCore 的都没能搞！现在想想还有点不可思议。</p><p>另外这两天感觉就是：VSCode真好用！智能提示真爽快，写 Python、js之类都真是够方便的，就像 Vs Studio 写 C# 似的。</p><hr><p>昨天还是没收完…今天是6月14日端午节，终于补充完毕了。</p><blockquote><p>参考文章:<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/cungudafa/article/details/104282643">Hexo（sakura）添加live2d看板动画</a><br><a target="_blank" rel="noopener" href="https://nocilol.me/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02/">给博客添加能动的看板娘(Live2D)-将其添加到网页上吧</a><br><a target="_blank" rel="noopener" href="http://live2d.pavostudio.com/doc/zh-cn/live2d/model-json-example/">Live2DViewerEX文档</a></p></blockquote><br><br><hr><script type="text/javascript" src="https://fastly.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><div id="vcomments"></div><script>new Valine({el:"#vcomments",appId:"MsaVbSzIr9cIfikihDExdun9-gzGzoHsz",appKey:"Bj6SEFUBomrLOTWx9B8S6zQH",placeholder:"请输入评论内容~",avatar:"mp",visitor:!1})</script></div><div class="fl w-100 w-30-l center fw3 lh-copy pl4-ns tl black-50"><hr class="dn-l mw4 black-50 mt5"><div class="mt5 mt0-l site-author"><article class="dt db-l mw8 mw8-m mw5-ns center ml0-l bg-white mv3"><div class="dn dtc-m db-l v-mid tc pr4 pr0-l" style="min-width:6rem"><img src="https://fastly.jsdelivr.net/gh/CWHISME/CWHISME.github.io@master/img/photo.jpg" class="mb4-l br-100 h3 w3 h4-l w4-l dib" title="CWHISME"></div><div class="dtc db-l v-mid lh-copy measure center f6 black-50 tj">悲观主义的末日</div></article></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>分类</h3><p><a href="/categories/博客/">博客</a></p></div><hr class="dn-l mw4 black-50 mt5"><div class="mt5 tc tl-l"><h3>近期文章</h3><p><a href="/2022/12/10/%E5%8D%8F%E5%8F%98%E5%92%8C%E9%80%86%E5%8F%98/">协变和逆变</a></p><p><a href="/2022/12/06/Unity%E7%9A%84%E9%98%B4%E5%BD%B1%E4%B8%8E%E5%85%89%E7%85%A7%E7%83%98%E7%84%99/">Unity 的阴影与光照烘焙</a></p><p><a href="/2022/11/23/%E6%89%93%E5%8C%85AssetBundle%E5%9F%BA%E7%A1%80%E8%A7%84%E5%88%99%E6%95%B4%E7%90%86/">打包 AssetBundle 的基础规则整理</a></p><p><a href="/2022/11/18/StringBuilder%E6%89%A9%E5%AE%B9%E8%A7%84%E5%88%99%E7%A0%94%E7%A9%B6/">StringBuilder 扩容规则研究</a></p><p><a href="/2022/11/17/%E6%B5%8B%E8%AF%95%E6%89%8B%E5%8A%A8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">简单测试手动垃圾回收</a></p></div></div></div></div></div></div><div class="bg-1 ph2 ph5-ns pv5"><div class="mv8"><div class="center tc"><div class="dib mh3"><a class="f3 f2-ns white dim" href="https://github.com/CWHISME" target="_blank"><i class="fa fa-github"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="mailto:cwhisme@126.com" target="_blank"><i class="fa fa-envelope"></i></a></div><div class="dib mh3"><a class="f3 f2-ns white dim" href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div></div><div class="f6 f5-ns center tc white pt5 fw3">Copyright © 2021 | Design & Hexo <a class="link dim white" target="_blank" rel="noopener" href="https://github.com/klugjo/hexo-theme-anodyne/">Jonathan Klughertz</a> | Modify By CWHISME</div></div></div></body></html>