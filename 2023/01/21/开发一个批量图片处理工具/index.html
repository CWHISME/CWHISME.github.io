<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="CWHISME" href="https://wangjiaying.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="CWHISME" href="https://wangjiaying.top/atom.xml"><link rel="alternate" type="application/json" title="CWHISME" href="https://wangjiaying.top/feed.json"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="工具,WPF"><link rel="canonical" href="https://wangjiaying.top/2023/01/21/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/"><title>开发一个批量图片处理工具 - 工具 | Jiaying's Note = CWHISME = 人不能没有梦想，也要有足够的敬畏</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">开发一个批量图片处理工具</h1><div class="meta"><span class="item" title="创建时间：2023-01-21 19:37:15"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-01-21T19:37:15+08:00">2023-01-21</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>10 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Jiaying's Note</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="/images/coverimages/large/6833939bly1gipey0a334j20zk0m8qpt.webp"></li><li class="item" data-background-image="/images/coverimages/large/96498872_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/mmexport1593752441185.webp"></li><li class="item" data-background-image="/images/coverimages/large/87092008_p0.webp"></li><li class="item" data-background-image="/images/coverimages/large/mmexport1588569411122.webp"></li><li class="item" data-background-image="/images/coverimages/large/61351818_p0.webp"></li></ul></div><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div></header><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="item" rel="index" title="分类于 工具"><span itemprop="name">工具</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://wangjiaying.top/2023/01/21/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/../img/avator"><meta itemprop="name" content="WangJiaYing"><meta itemprop="description" content="人不能没有梦想，也要有足够的敬畏, 己所不欲，勿施于人"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="CWHISME"></span><div class="body md" itemprop="articleBody"><h1 id="前言"><a class="anchor" href="#前言">#</a> 前言</h1><p>想做这个的原因有两点：</p><ol><li>Unity 的各项压缩格式，除 RGB 不压缩及 ASTC，基本都只支持 POT 分辨率的图，但是美术给的图相当不合规范</li><li>最近在给自己博客换了主题，因为 Shoka 随机壁纸采用的<s>新浪图床</s>也不再提供服务，想着直接把随机图片托管到 GitPages 算了，GitPages 的速度大家都知道，这就涉及到一个尽量压缩少大小，以期减少加载时间的问题</li></ol><p>之前直接在 Unity 里边写过一个小脚本，可以批量一键将图片『截取』为指定分辨率。</p><p>由于利用的是 Unity <code>Texture2D</code> 类，这个类提供的处理方式很简单粗暴：直接按像素设置。所以只能做到 『截取』功能，没法做到『缩放』。</p><p>比如一个图片是 <code>1920x1080</code> ，如果想将其分辨率改成 <code>1280x720</code> ，得到的恐怕就只是这张图片其中的 <code>一部分</code> 了，例如：上半部分一小块、中间部分一小块，然后形成低分辨率。</p><p>如图所示：<br><img data-src="/blogimages/2023/2023-01-21/m_70ba3b13a8846f219547f93a05ccf5b3_r.jpeg" alt=""></p><p>也就是说 <code>Texture2D</code> 只能单纯『截取』，而且中间可能还会涉及到获取分辨率与设置分辨率差异量过大导致越界异常等问题。</p><p>昨天晚上回家后，查到 C# 其实就提供了对应的处理方法，可以利用 <code>System.Drawing.Image</code> 、 <code>System.Drawing.Graphics</code> 进行缩放操作，然后简单用 <code>UnityEditor</code> 写了个工具，可以根据图片宽度进行『截取缩放』，而非之前 <code>Texture2D</code> 那样单纯只能截取。</p><p><img data-src="/blogimages/2023/2023-01-21/m_f820f6115247ad9088a9c7abebe2a930_r.png" alt=""></p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">GUIStyle</span> _style<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">MenuItem</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Textures/CutTexturesWindow"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CutTesturesCenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        _style <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">GUIStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token generic-method"><span class="token function">GetWindow</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>TexturesCutWindow<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">string</span></span> _path<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment">// 截取中间部分</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">bool</span></span> _isCutCenter<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 截取分辨率</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">Vector2Int</span> _cutPixels <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector2Int</span><span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnGUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        EditorGUILayout<span class="token punctuation">.</span><span class="token function">BeginHorizontal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>GUILayout<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">"选择"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            _path <span class="token operator">=</span> EditorUtility<span class="token punctuation">.</span><span class="token function">OpenFolderPanel</span><span class="token punctuation">(</span><span class="token string">"选择一个待处理文件夹"</span><span class="token punctuation">,</span> _path<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        EditorGUILayout<span class="token punctuation">.</span><span class="token function">LabelField</span><span class="token punctuation">(</span><span class="token string">"目录："</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>_path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            _style<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>textColor <span class="token operator">=</span> UnityEngine<span class="token punctuation">.</span>Color<span class="token punctuation">.</span>red<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            GUILayout<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span><span class="token string">"请选择一个目录！"</span><span class="token punctuation">,</span> _style<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token keyword">else</span> GUILayout<span class="token punctuation">.</span><span class="token function">Label</span><span class="token punctuation">(</span>_path<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        EditorGUILayout<span class="token punctuation">.</span><span class="token function">EndHorizontal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        _isCutCenter <span class="token operator">=</span> EditorGUILayout<span class="token punctuation">.</span><span class="token function">Toggle</span><span class="token punctuation">(</span><span class="token string">"截取中间部分"</span><span class="token punctuation">,</span> _isCutCenter<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        _cutPixels <span class="token operator">=</span> EditorGUILayout<span class="token punctuation">.</span><span class="token function">Vector2IntField</span><span class="token punctuation">(</span><span class="token string">"分辨率"</span><span class="token punctuation">,</span> _cutPixels<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>GUILayout<span class="token punctuation">.</span><span class="token function">Button</span><span class="token punctuation">(</span><span class="token string">"截取"</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">string</span><span class="token punctuation">.</span><span class="token function">IsNullOrEmpty</span><span class="token punctuation">(</span>_path<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                EditorUtility<span class="token punctuation">.</span><span class="token function">DisplayDialog</span><span class="token punctuation">(</span><span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"请选择一个目录！"</span><span class="token punctuation">,</span> <span class="token string">"OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token keyword">return</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            <span class="token function">CutTestures</span><span class="token punctuation">(</span>_path<span class="token punctuation">,</span> _isCutCenter<span class="token punctuation">,</span> _cutPixels<span class="token punctuation">.</span>x<span class="token punctuation">,</span> _cutPixels<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">CutTestures</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> path<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> isCenter<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> width<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> height<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> textures <span class="token operator">=</span> Directory<span class="token punctuation">.</span><span class="token function">GetFiles</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token string">"*.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token class-name"><span class="token keyword">string</span></span> resultPath <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token string">"_CutResult_CenterPixel_"</span> <span class="token operator">+</span> isCenter<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>Directory<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>resultPath<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre>            Directory<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span>resultPath<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        Directory<span class="token punctuation">.</span><span class="token function">CreateDirectory</span><span class="token punctuation">(</span>resultPath<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token class-name"><span class="token keyword">string</span></span> texPath<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token class-name"><span class="token keyword">int</span></span> texNum <span class="token operator">=</span> textures<span class="token punctuation">.</span>Length<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> texNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>            texPath <span class="token operator">=</span> textures<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>            EditorUtility<span class="token punctuation">.</span><span class="token function">DisplayProgressBar</span><span class="token punctuation">(</span><span class="token string">"提示"</span><span class="token punctuation">,</span> <span class="token string">"处理中："</span> <span class="token operator">+</span> texPath<span class="token punctuation">,</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>texNum<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>            <span class="token class-name">Bitmap</span> bitmap <span class="token operator">=</span> <span class="token function">ZoomImage</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bitmap</span><span class="token punctuation">(</span>texPath<span class="token punctuation">)</span><span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>            bitmap<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span>Path<span class="token punctuation">.</span><span class="token function">Combine</span><span class="token punctuation">(</span>resultPath<span class="token punctuation">,</span> Path<span class="token punctuation">.</span><span class="token function">GetFileName</span><span class="token punctuation">(</span>texPath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>            Debug<span class="token punctuation">.</span><span class="token function">Log</span><span class="token punctuation">(</span><span class="token string">"处理完毕："</span> <span class="token operator">+</span> texPath<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        EditorUtility<span class="token punctuation">.</span><span class="token function">ClearProgressBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token comment">// 等比例缩放图片</span></pre></td></tr><tr><td data-num="64"></td><td><pre>    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name">Bitmap</span> <span class="token function">ZoomImage</span><span class="token punctuation">(</span><span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> destWidth<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">int</span></span> destHeight<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token keyword">try</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>            <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Image</span> sourImage <span class="token operator">=</span> bitmap<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>            <span class="token class-name">Bitmap</span> destBitmap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Bitmap</span><span class="token punctuation">(</span>destWidth<span class="token punctuation">,</span> destHeight<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>            <span class="token class-name">System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Graphics</span> g <span class="token operator">=</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Graphics<span class="token punctuation">.</span><span class="token function">FromImage</span><span class="token punctuation">(</span>destBitmap<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>            g<span class="token punctuation">.</span><span class="token function">Clear</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Color<span class="token punctuation">.</span>Transparent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>            g<span class="token punctuation">.</span>CompositingQuality <span class="token operator">=</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Drawing2D<span class="token punctuation">.</span>CompositingQuality<span class="token punctuation">.</span>HighQuality<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>            g<span class="token punctuation">.</span>SmoothingMode <span class="token operator">=</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Drawing2D<span class="token punctuation">.</span>SmoothingMode<span class="token punctuation">.</span>HighQuality<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>            g<span class="token punctuation">.</span>InterpolationMode <span class="token operator">=</span> System<span class="token punctuation">.</span>Drawing<span class="token punctuation">.</span>Drawing2D<span class="token punctuation">.</span>InterpolationMode<span class="token punctuation">.</span>HighQualityBicubic<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>            <span class="token comment">// 尝试以宽度为基准，截取缩放</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            g<span class="token punctuation">.</span><span class="token function">DrawImage</span><span class="token punctuation">(</span>sourImage<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> destWidth<span class="token punctuation">,</span> destHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> sourImage<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> sourImage<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token punctuation">(</span>destWidth <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>destHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> GraphicsUnit<span class="token punctuation">.</span>Pixel<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            g<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>            sourImage<span class="token punctuation">.</span><span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>            <span class="token keyword">return</span> destBitmap<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="81"></td><td><pre>        <span class="token keyword">catch</span></pre></td></tr><tr><td data-num="82"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>            <span class="token keyword">return</span> bitmap<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>这种方式实现的话，可以以图片宽度为基准，再确定是否截取高度，或者不足填充透明度 —— 也就是说支持基于宽度的缩放。</p><p>如图所示，是将 <code>1920x1200</code> 缩放至 <code>700x300</code> 分辨率：<br><img data-src="/blogimages/2023/2023-01-21/m_3b66b8ee697959d44ac5ae453d8cba7e_r.jpeg" alt=""></p><p>后来一想：为啥不直接写成一个通用的工具，每次使用还得打开 Unity 么？<br>而且做成工具后，还可以根据需求，截取完毕后作一条龙处理：后续转其它例如 WebP 之类的格式。</p><h1 id="需求"><a class="anchor" href="#需求">#</a> 需求</h1><p>由于项目存在大量 NPOT 图片，导致压缩格式难以生效，大量图片实际处于 RGBA32 模式，且 Unity 自带的 POT 缩放会导致变形 (Sprite 也无法使用) 因此想要实现一个通用的 WPF 工具，可以大批量将图片正确重新缩放为 2N 次方或其它模式的工具，至少包含以下功能：</p><ol><li>批量处理图片</li><li>直接缩放图片，完全将旧图缩放至新分辨率，不拉伸，不足处使用透明度填充</li><li>基于宽度或高度缩放图片，不足处裁剪</li><li>基于图片当前分辨率，缩放至最接近的 2N 次方分辨率，可选是否将宽高缩放至一致，不足以透明度填充</li><li>可以设定 X、Y 偏移量，丢弃偏移量之前的像素</li><li>可以直接选择最终存储格式，使其可以当做一个格式转换器使用</li><li>可以事先预览各个选项造成的结果</li></ol><h1 id="研究"><a class="anchor" href="#研究">#</a> 研究</h1><p>于是在网上先是以 <code>C# 图片处理库</code> 这种关键字查了下</p><p>找到了一个 <span class="exturl" data-url="aHR0cHM6Ly9kZXZibG9ncy5taWNyb3NvZnQuY29tL2RvdG5ldC9uZXQtY29yZS1pbWFnZS1wcm9jZXNzaW5nLw==">net-core-image-processing</span> 的文章（对应翻译 <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25928777">【渣翻译】.NET Core 图片处理<br></a>）</p><p>最后选中了 <code>ImageSharp</code> 这个图像处理库，不为什么，就因为它是纯 C# 实现，感觉可能更方便。</p><p>Git 地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL1NpeExhYm9ycy9JbWFnZVNoYXJw">ImageSharp</span></p><h1 id="问题"><a class="anchor" href="#问题">#</a> 问题</h1><p>在使用 WPF 过程中碰到了不少问题，毕竟以前虽然有用过，但都是简单用用，没有深入研究。</p><p>这次想实现一点 高级特性 功能就感觉不够用了，碰到了不少问题。</p><p>然后越记录越多，因此还是新开一个文档记录了，具体在：使用 WPF 问题记录</p><h1 id="缩放方式"><a class="anchor" href="#缩放方式">#</a> 缩放方式</h1><p>目前准备支持选择的缩放方式如下：</p><ul><li>不缩放：不会改变原本分辨率</li><li>直接缩放：直接缩放为设置的分辨率，不足之处直接拉伸，会造成变形</li><li>比例缩放：将原图缩放至指定分辨率时尽量保持比例不变，多余处填充透明度</li><li>比例裁剪：以高度或宽度最大者为基准进行缩放，尽量保持比例不变，多余处直接裁剪</li><li>基于宽度：以宽度为基准进行缩放，高度不足则以透明度填充，高度超过之处则裁剪</li><li>基于高度：以高度为基准进行缩放，宽度不足则以透明度填充，宽度超过之处则裁剪</li><li>填充缩放：如果图片小于设定分辨率，则不改变图片原有像素大小，不足之处以透明度填充；如果图片大于设定分辨率，则比例缩放</li><li>POT 缩放：高宽缩放至最接近 2N 次方的分辨率，尽量保持比例不变，不足处进行透明度填充</li></ul><h2 id="直接缩放"><a class="anchor" href="#直接缩放">#</a> 直接缩放</h2><p>直接将原分辨率拉伸填满设定的新分辨率，会造成拉伸变形，实现要也是最简单的，直接调用接口默认就是这种模式。</p><h2 id="比例缩放"><a class="anchor" href="#比例缩放">#</a> 比例缩放</h2><p>自动基于高度或宽度，保持比例不变的情况下缩放至新图。</p><p>分析：</p><p>既然是保持比例不变，那么首先需要计算出原图的比例。</p><p>例如原图为 <code>720x1280</code> 需要缩放至 <code>1280x720</code> :</p><p><img data-src="/blogimages/2023/2023-01-21/m_2b8041e6dc4de2ab9dd4e77af924ffa2_r.png" alt=""></p><ul><li>原始比例为：720/1280=0.5625</li><li>保持不变的情况下，若基于宽度，则高度为：1280/0.5625=2275</li><li>保持不变的情况下，若基于高度，则宽度为：720x0.5625=405</li><li>由于此时基于宽度的情况下，高度将会越界，因此只能选择基于高度</li><li>即新的分辨率为：405x720</li><li>像素复制开始位置为：(1280-405)/2,(720-720)/2</li></ul><p>基本代码如下：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> startX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> startY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 先计算原图比例</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name"><span class="token keyword">float</span></span> scaleRatio <span class="token operator">=</span> image<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>image<span class="token punctuation">.</span>Height<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 再按照比例映射至新图时，什么分辨率合适</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 保持不变的情况下，若基于宽度</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> newHeight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width <span class="token operator">/</span> scaleRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">// 保持不变的情况下，若基于高度</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> newWidth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Height <span class="token operator">*</span> scaleRatio<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">// 新的正确比例情况下，哪个正确不越界</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>newHeight <span class="token operator">></span> data<span class="token punctuation">.</span>Height<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 基于宽度，新的高度越界了那么，取基于高度</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    newHeight <span class="token operator">=</span> data<span class="token punctuation">.</span>Height<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment">// 基于高度，新的宽度越界了那么，取基于宽度</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    newWidth <span class="token operator">=</span> data<span class="token punctuation">.</span>Width<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>startX <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width <span class="token operator">-</span> newWidth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>startY <span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Height <span class="token operator">-</span> newHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> data<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> data<span class="token punctuation">.</span>ResamplerAlgorithm<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span>startX<span class="token punctuation">,</span> startY<span class="token punctuation">,</span> newWidth<span class="token punctuation">,</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>效果如下：</p><p><img data-src="/blogimages/2023/2023-01-21/m_bcd51791799f9a3a1bb7f81a487e5ce5_r.png" alt=""></p><hr><p>当做完这个效果之后，点进去看了下接口，结果发现了如果采用 <code>ResizeOptions</code> 作为参数传递，有一个 <code>ResizeMode</code> 的枚举：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">//</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">//     Provides enumeration over how the image should be resized.</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ResizeMode</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">//     Crops the resized image to fit the bounds of its container.</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        Crop<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token comment">//     Pads the resized image to fit the bounds of its container. If only one dimension</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token comment">//     is passed, will maintain the original aspect ratio.</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        Pad<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token comment">//     Pads the image to fit the bound of the container without resizing the original</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token comment">//     source. When downscaling, performs the same functionality as SixLabors.ImageSharp.Processing.ResizeMode.Pad</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        BoxPad<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">//     Constrains the resized image to fit the bounds of its container maintaining the</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token comment">//     original aspect ratio.</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        Max<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token comment">//     Resizes the image until the shortest side reaches the set given dimension. Upscaling</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment">//     is disabled in this mode and the original image will be returned if attempted.</span></pre></td></tr><tr><td data-num="29"></td><td><pre>        Min<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment">//     Stretches the resized image to fit the bounds of its container.</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        Stretch<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token comment">//</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token comment">// 摘要:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token comment">//     The target location and size of the resized image has been manually set.</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        Manual</pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>... 感觉看着有点不对劲，是不是又造轮子了？这个功能是 <code>ImageSharp</code> 就有的么...</p><p>然后稍微研究了下，好像真的是提供了基础的缩放设定的... 只是之前我一直使用普通传参方式调用，导致才发现这么个接口。</p><p>不过后续研究了下发现，自带的接口 <code>Pad/BoxPad</code> 确实类似的于上述我实现的缩放模式，不过仅限于缩小时，当指定分辨率比图更大时，自带的接口不会缩放图片大小，而是直接填充透明度 —— 这样功能更类似于 <code>填充缩放</code> ，对比结果：</p><p><img data-src="/blogimages/2023/2023-01-21/m_15956b46e6ea54dcb2c30926f64fedec_r.png" alt=""></p><p>左边是我实现的方法，右边是自带的 <code>Pad/BoxPad</code> 模式。</p><p>于是比例缩放还是用自己方法，填充缩放则直接调用 <code>ImageSharp</code> 接口了。</p><h2 id="比例裁剪"><a class="anchor" href="#比例裁剪">#</a> 比例裁剪</h2><p>直接使用 Imagesharp 的 <code>Crop</code> 模式</p><h2 id="基于宽度高度"><a class="anchor" href="#基于宽度高度">#</a> 基于宽度 / 高度</h2><p>与上面自定义的算法其实是一样的，只是固定为宽度或高度为准，不再判断哪个边更『长』</p><p>基于宽度，就是把宽度当做不变的值，根据原图比例，重设新的宽度下的高度值：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">case</span> EScaleMode<span class="token punctuation">.</span>WidthBase<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 基于宽度，计算新的高度</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> newHeight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>image<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> data<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> data<span class="token punctuation">.</span>ResamplerAlgorithm<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>Height <span class="token operator">-</span> newHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> newHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">break</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>基于高度，把高度当做不变的值，根据原图比例，重设新的高度下的宽度值：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">case</span> EScaleMode<span class="token punctuation">.</span>HeightBase<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 基于高度，计算新的宽度</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> newWidth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Height <span class="token operator">*</span> <span class="token punctuation">(</span>image<span class="token punctuation">.</span>Width <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span>image<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>image<span class="token punctuation">.</span><span class="token function">Mutate</span><span class="token punctuation">(</span>x <span class="token operator">=></span> x<span class="token punctuation">.</span><span class="token function">Resize</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> data<span class="token punctuation">.</span>Height<span class="token punctuation">,</span> data<span class="token punctuation">.</span>ResamplerAlgorithm<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> image<span class="token punctuation">.</span>Width<span class="token punctuation">,</span> image<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Rectangle</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>Width <span class="token operator">-</span> newWidth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> newWidth<span class="token punctuation">,</span> data<span class="token punctuation">.</span>Height<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h2 id="pot缩放"><a class="anchor" href="#pot缩放">#</a> POT 缩放</h2><p>POT 指的 Power of two，即 2N 次方，即需求是计算 <strong>计算与指定数值最接近的 2N 次方</strong></p><p>Unity 里边除了 ASTC 外，其它压缩格式均要求 POT 分辨率格式的图片</p><p>Unity 本身其实也自带了 POT 缩放的选项，不过它只是单纯拉伸图片，使其撑满缩放后的分辨率，会造成变形。</p><p>这里我则是想实现不拉伸的缩放：高宽缩放至最接近 2N 次方的分辨率，尽量保持比例不变，不足处进行透明度填充</p><h3 id="缩放计算"><a class="anchor" href="#缩放计算">#</a> 缩放计算</h3><p>这里计算最接近 2N 的方式大概有 3 种：</p><ul><li>除二计算 (自顶向下)</li><li>乘二计算 (自底向上)</li><li>二进制操作</li></ul><p>其中二进制操作是在网上看到的方法</p><h4 id="除二计算"><a class="anchor" href="#除二计算">#</a> 除二计算</h4><p>指定数字 X 不断除二，直到 X 不再大于 0，期间计算了 N 次，那么 2N 次方就是最接近 X 的 POT 数。</p><p>代码如下：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token operator">=</span><span class="token number">1080</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">do</span> <span class="token punctuation">&#123;</span> x <span class="token operator">/=</span> <span class="token number">2</span><span class="token punctuation">;</span> n<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function">Print</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">Pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h4 id="乘二计算"><a class="anchor" href="#乘二计算">#</a> 乘二计算</h4><p>跟上一种方式类似</p><p>不过是从下往上判断，2 不断往上乘，直到获得的数值超出了 X</p><p>代码如下：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> x <span class="token operator">=</span> <span class="token number">1080</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;</span> x<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> n <span class="token operator">*=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// 若取比 X 更小的 2N 数值</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">//n-=1</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token function">Print</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>这种方式有个缺点，原因是由于采用比较方式，原数值并未参与 <code>计算</code> ，测了一下大概是：只能取比 X 大的或者比 X 小的 POT 数值，并不能取到 <code>最接近</code> 的 2N 数值。</p><h4 id="二进制操作"><a class="anchor" href="#二进制操作">#</a> 二进制操作</h4><p>这是在网上看到的一种方法，通过位移计算：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Calc</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	 x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>     x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	 <span class="token comment">// 比 X 小的 2N 数值</span></pre></td></tr><tr><td data-num="10"></td><td><pre>     <span class="token keyword">return</span> x <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	 <span class="token comment">// 比 X 大的 2N 数值</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	 <span class="token keyword">return</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>缺点与 乘二计算 一致，只能取比指定数字 X 更大，或者更小的 2N 数值（除非再增加额外判断或者改造）</p><p>实现方式感觉很巧妙，于是简单分析了下，以数字 100 为例：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//		1100100</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//	 110010</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//	  11001</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//	    110</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//	      0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">1</span><span class="token operator">|</span>x <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//					111011</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">1</span><span class="token operator">|</span>x <span class="token operator">>></span> <span class="token number">2</span> <span class="token operator">|</span> x <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//			111111</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">1</span> <span class="token operator">|</span> x <span class="token operator">>></span> <span class="token number">2</span> <span class="token operator">|</span> x <span class="token operator">>></span> <span class="token number">4</span><span class="token operator">|</span>x <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token comment">//	111111</span></pre></td></tr></table></figure><p>可以发现，100 直接转二进制是有 7 位的，</p><ul><li>当右移一位后，变成了 6 位</li><li>右移二位后，变成了 5 位</li><li>右移四位后，变成 3 位</li><li>右移八位后，变成 1 位 0 (这是因为 100 太小了)</li></ul><p>每次或运算，都会使得对应位数变成 1，最后会使得整个二进制全部变成 1，即 『 <code>1111111</code> 』(长度以右移一位为准)，同样的位数全部为 1 肯定会比原值更大，不过这种格式转为十进制后，是 <code>2N-1</code> ，因此 + 1 之后就变成『 <code>10000000</code> 』这种格式转为十进制即为 2N</p><hr><p>上面的分析是否准确呢？</p><p>其实，恰好因为我选的数字是 100，才造成了这种 <code>看似正确</code> 的结果，实际上是 <code>有误</code> 的。</p><p>仔细看原算法，每次 <code>或运算之前</code> ，x 的值都是之前的修改过的值基础上进行，而在上述使用 100 为例的分析中，打印的都只是 100 直接位移之后的二进制值。</p><p>如果换一个数字，例如 <code>128</code> :</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x <span class="token operator">>></span> <span class="token number">1</span> <span class="token operator">|</span> x <span class="token operator">>></span> <span class="token number">2</span> <span class="token operator">|</span> x <span class="token operator">>></span> <span class="token number">4</span><span class="token operator">|</span>x <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">"1101000"</span></pre></td></tr></table></figure><p>是吧，完全乱了。</p><p>如果想依照这种算法计算，那么每次位移递增都只能是 1 位，而非 2N 递增。</p><p>之所以能够 2N 递增的原因是，与前值进行位移后，就包含了之前的</p><p>例如，还是以 128 为例：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">128</span><span class="token operator">=</span>      <span class="token string">"10000000"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token string">"10000000"</span><span class="token operator">|</span><span class="token string">"1000000"</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token operator">>></span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"11000000"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">"11000000"</span><span class="token operator">|</span><span class="token string">" 110000"</span><span class="token punctuation">(</span><span class="token number">11000000</span><span class="token operator">>></span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"11110000"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"11110000"</span><span class="token operator">|</span><span class="token string">"  1111"</span><span class="token punctuation">(</span><span class="token number">11110000</span><span class="token operator">>></span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"11111111"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">"11111111"</span><span class="token operator">|</span><span class="token string">"     0"</span><span class="token punctuation">(</span><span class="token number">11111111</span><span class="token operator">>></span><span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token string">"11111111"</span></pre></td></tr></table></figure><p>因为每次或运算都是在前者基础上进行，因此可移动的位数是倍增的，在二进制位移层面上，倍增的表现就是以 2N 递增。</p><ul><li>第一次移动 1 位 (变成 2 个单位)</li><li>第二次移动 2 位 (变成 4 个单位)</li><li>第三次移动 4 位 (变成 8 个单位)</li><li>第四次移动 8 位 (变成 16 个单位)</li></ul><p>当然，由于这里 128 本身只有 8 位，右移 8 位 后结果直接为 0，因此实际到第三次移动时就已经确定了结果，第四次属于无效操作。</p><p>所以在上面的算法中，最高右移 8 位，即代表最高支持 2^16 次方数值：65535 及以下</p><p>测试结果很简单，加上打印，并传入 65536：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">Calc</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">.</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">.</span>     <span class="token function">Print</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">.</span>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">.</span>     <span class="token function">Print</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">.</span>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">.</span>     <span class="token function">Print</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">.</span>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">.</span>     <span class="token function">Print</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">.</span>     x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">.</span>     <span class="token function">Print</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">.</span>     x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">.</span>     <span class="token function">Print</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">.</span>     <span class="token comment">// 比 X 大的 2N 数值</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">.</span>     <span class="token keyword">return</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> <span class="token function">Calc</span><span class="token punctuation">(</span><span class="token number">65536</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token string">"10000000000000000"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token string">"11000000000000000"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token string">"11110000000000000"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token string">"11111111000000000"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token string">"11111111111111110"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token string">"11111111111111111"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">131071</span></pre></td></tr></table></figure><p><code>65536</code> 的下一个 2N 应该是 <code>131072</code> ，这里计算出来直接少了一位了。</p><p>同理可得加上第四次移动 <code>x &gt;&gt; 16</code> ，理论上最大可以支持 <code>2^32</code> 次方。</p><h3 id="采用算法"><a class="anchor" href="#采用算法">#</a> 采用算法</h3><p>考虑了一下，决定使用位运算的方式，毕竟这看着就比前两种暴力算法厉害。</p><p>另外，由于我这里是对分辨率的修改，没有那么高的数值需求 —— 至少感觉不可能有那么大的分辨率，因此最多移动四次即可。</p><p>最后再加上接近判断，就可以弄出三个函数分别代表 <code>最接近</code> 、 <code>更小</code> 、 <code>更大</code> ，与 Unity 提供的 POT 缩放模式一致：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/// &lt;summary></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">/// 计算给定数值的 POT（根据缩放模式返回给定数值接近的 2N 数值）</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">/// 最大支持 65535</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">/// &lt;/summary></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">/// &lt;returns>&lt;/returns></span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> <span class="token function">CalcPot</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> x<span class="token punctuation">,</span> <span class="token class-name">EPotMode</span> mode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name"><span class="token keyword">int</span></span> oldX <span class="token operator">=</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">4</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    x <span class="token operator">|=</span> x <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token class-name"><span class="token keyword">int</span></span> minPot <span class="token operator">=</span> x <span class="token operator">>></span> <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">switch</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">case</span> EPotMode<span class="token punctuation">.</span>ToNearest<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token comment">// 判断哪个更接近 X</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">return</span> x <span class="token operator">-</span> oldX <span class="token operator">></span> oldX <span class="token operator">-</span> <span class="token class-name">minPot <span class="token punctuation">?</span></span> minPot <span class="token punctuation">:</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">case</span> EPotMode<span class="token punctuation">.</span>ToLarger<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token comment">// 比 X 大的 2N 数值</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token keyword">return</span> x<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">case</span> EPotMode<span class="token punctuation">.</span>ToSmaller<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token comment">// 比 X 小的 2N 数值</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">return</span> minPot<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token comment">// 出问题了？</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token keyword">return</span> oldX<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="bool字节对齐"><a class="anchor" href="#bool字节对齐">#</a> Bool 字节对齐</h2><p>在重构代码，以使枚举可以更方便支持 WPF 数据绑定时，我采用了扩展函数的形式，并对数据进行了缓存。</p><p>由于定义的结构体，特意注意了一下字节对齐，发现 1 个 bool 变量 + 2 个指针变量是 24 个字节</p><p>再增加一个 bool 变量也是 24 个字节，但加到 3 个就不对了，变成了 32 个字节。</p><p>然后就单独分析了下，直接调用 <code>sizeof</code> 确实是 1 个字节，但放结构体使用 <code>Marshal.SizeOf</code> 就变成 4 个字节了：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">bool</span></span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">></span> <span class="token keyword">private</span> <span class="token keyword">struct</span> <span class="token class-name">CacheData</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">.</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">.</span>     <span class="token keyword">public</span> <span class="token class-name"><span class="token keyword">bool</span></span> IsAddFirstName<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">.</span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> Marshal<span class="token punctuation">.</span><span class="token function">SizeOf</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">CacheData</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">4</span></pre></td></tr></table></figure><p>其实，不只是放结构体， <code>Marshal.SizeOf</code> 直接获取到的大小就是 4 个字节：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">></span> System<span class="token punctuation">.</span>Runtime<span class="token punctuation">.</span>InteropServices<span class="token punctuation">.</span>Marshal<span class="token punctuation">.</span><span class="token function">SizeOf</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name"><span class="token keyword">bool</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">4</span></pre></td></tr></table></figure><p>其它比如 <code>Char</code> 类型，sizeof=2，Marshal.SizeOf=1</p><p>以前还没注意到，这里需要注意下。</p><h2 id="可空类型泛型模板需要返回-null-值问题"><a class="anchor" href="#可空类型泛型模板需要返回-null-值问题">#</a> 可空类型泛型模板需要返回 Null 值问题</h2><p>在扩展枚举之后，又有一个新的需求：因为 ImageSharp 中的自动检测设置采用的可空类型，若类型为空则自动检测。</p><p>为了顺应同样的规则，Wrap 设置我也一样定义为了可空类型</p><p>然后我有一个函数，可以将下标转枚举，第一位是后期加上的一个字符串名字『自动』，如图所示：</p><p><img data-src="/blogimages/2023/2023-01-21/m_2137b911f5a7d60bdeb9c66a43c9851e_r.png" alt=""></p><p>这个『自动』并非枚举中的值，当使用者选择『自动』时，我会将对应枚举变量设置为空 —— 因此就有了一个问题：可空类型的模板方法，如何返回空值？</p><p>直接 <code>return null</code> 会报错并提示：</p><p><img data-src="/blogimages/2023/2023-01-21/m_ae323d03b08e0f2c2a61e9553a364efc_r.png" alt=""></p><p>解决方式很简单 (虽然花了点时间)</p><p>顺应可空了类型本身的实现原理去分析了下：我们都知道可空类型本身是 <code>Nullable</code> 的二次封装，那么是否可以返回 <code>Nullable</code> 类型以解决这个问题？</p><p>如果想要 <code>return new Nullable&lt;T&gt;()</code> ，泛型约束必须加上 <code>struct</code> ，如下所示：</p><figure class="highlight cs"><figcaption data-lang="C#"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name">T<span class="token punctuation">?</span></span> <span class="token generic-method"><span class="token function">IndexToEnumNullable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token class-name"><span class="token keyword">int</span></span> index<span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">bool</span></span> isAddFirstName <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> addFirstName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">where</span> <span class="token class-name">T</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">struct</span><span class="token punctuation">,</span> <span class="token class-name">Enum</span></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">Type</span> type <span class="token operator">=</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">T</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">CacheData</span> data <span class="token operator">=</span> <span class="token function">GetCacheNames</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> isAddFirstName<span class="token punctuation">,</span> addFirstName<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name"><span class="token keyword">object</span></span> <span class="token keyword">value</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>Enum<span class="token punctuation">.</span><span class="token function">TryParse</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> data<span class="token punctuation">.</span>Names<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">out</span> <span class="token keyword">value</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token keyword">return</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span><span class="token keyword">value</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Nullable<span class="token punctuation">&lt;</span>T<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>测试了下，外部接收者可空类型枚举确实变成 <code>null</code> 了</p><p>然后我又试了下，其实加上 <code>struct</code> 的泛型约束后，直接返回 <code>null</code> 也是可以的。</p><h1 id="最后"><a class="anchor" href="#最后">#</a> 最后</h1><p>现在是 2023 年 1 月 21 日，春节的前一天，除夕。这两天断断续续把最后的多线程批量处理功能加上去了，第一版暂且就这样了：</p><p><img data-src="/blogimages/2023/2023-01-21/Snipaste_2023-01-21_19-51-37.jpg" alt=""></p><p>对比了一下起初自己提到的各个需求，除了偏移功能，应该也都完成了：</p><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_0" checked disabled><label for="cbx_0">批量处理图片</label></li><li class="task-list-item"><input type="checkbox" id="cbx_1" checked disabled><label for="cbx_1">直接缩放图片，完全将旧图缩放至新分辨率，不拉伸，不足处使用透明度填充</label></li><li class="task-list-item"><input type="checkbox" id="cbx_2" checked disabled><label for="cbx_2">基于宽度或高度缩放图片，不足处裁剪</label></li><li class="task-list-item"><input type="checkbox" id="cbx_3" checked disabled><label for="cbx_3">基于图片当前分辨率，缩放至最接近的 2N 次方分辨率，可选是否将宽高缩放至一致，不足以透明度填充</label></li><li class="task-list-item"><input type="checkbox" id="cbx_4" disabled><label for="cbx_4">可以设定 X、Y 偏移量，丢弃偏移量之前的像素</label></li><li class="task-list-item"><input type="checkbox" id="cbx_5" checked disabled><label for="cbx_5">可以直接选择最终存储格式，使其可以当做一个格式转换器使用</label></li><li class="task-list-item"><input type="checkbox" id="cbx_6" checked disabled><label for="cbx_6">可以事先预览各个选项造成的结果</label></li></ul><p>另外批量处理图片采用多线程处理 —— 同时开启处理量取决于 CPU 核心数目，以后也会会加个自定义数量？</p><hr><p>在开始弄之前，可没想到会花这么长时间 —— 其实大多数时间都花在搞 UI 上去了... 做实际处理逻辑的功能虽然也花时间，但相比下来就不算什么了。</p><p>今年也没回家，今天已经是除夕了，先把功能收尾了。暂且这样吧，后边自己试用过后再看有没有想完善的再完善下。</p><p>最后，项目地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NXSElTTUUvQmF0Y2hUZXh0dXJlTW9kaWZpZXIuZ2l0">GitHub</span></p><div class="tags"><a href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag"><i class="ic i-tag"></i> 工具</a> <a href="/tags/WPF/" rel="tag"><i class="ic i-tag"></i> WPF</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-02-04 14:15:27" itemprop="dateModified" datetime="2023-02-04T14:15:27+08:00">2023-02-04</time></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>WangJiaYing <i class="ic i-at"><em>@</em></i>CWHISME</li><li class="link"><strong>本文链接：</strong> <a href="https://wangjiaying.top/2023/01/21/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/" title="开发一个批量图片处理工具">https://wangjiaying.top/2023/01/21/开发一个批量图片处理工具/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/01/21/%E4%BD%BF%E7%94%A8WPF%E5%BC%80%E5%8F%91%E6%97%B6%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" itemprop="url" rel="prev" data-background-image="&#x2F;images&#x2F;coverimages&#x2F;large&#x2F;6833939bly1giclfb3vzhj20zk0m8wny.webp" title="使用WPF开发时问题记录"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 工具</span><h3>使用WPF开发时问题记录</h3></a></div><div class="item right"><a href="/2023/01/30/2022%E5%B9%B4%E6%80%BB%E7%BB%93/" itemprop="url" rel="next" data-background-image="&#x2F;images&#x2F;coverimages&#x2F;large&#x2F;96498872_p0.webp" title="2022年总结"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 总结</span><h3>2022年总结</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9C%80%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text">需求</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A0%94%E7%A9%B6"><span class="toc-number">3.</span> <span class="toc-text">研究</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">4.</span> <span class="toc-text">问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">缩放方式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E7%BC%A9%E6%94%BE"><span class="toc-number">5.1.</span> <span class="toc-text">直接缩放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E4%BE%8B%E7%BC%A9%E6%94%BE"><span class="toc-number">5.2.</span> <span class="toc-text">比例缩放</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%94%E4%BE%8B%E8%A3%81%E5%89%AA"><span class="toc-number">5.3.</span> <span class="toc-text">比例裁剪</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E5%AE%BD%E5%BA%A6%E9%AB%98%E5%BA%A6"><span class="toc-number">5.4.</span> <span class="toc-text">基于宽度 &#x2F; 高度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pot%E7%BC%A9%E6%94%BE"><span class="toc-number">5.5.</span> <span class="toc-text">POT 缩放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE%E8%AE%A1%E7%AE%97"><span class="toc-number">5.5.1.</span> <span class="toc-text">缩放计算</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%99%A4%E4%BA%8C%E8%AE%A1%E7%AE%97"><span class="toc-number">5.5.1.1.</span> <span class="toc-text">除二计算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B9%98%E4%BA%8C%E8%AE%A1%E7%AE%97"><span class="toc-number">5.5.1.2.</span> <span class="toc-text">乘二计算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%93%8D%E4%BD%9C"><span class="toc-number">5.5.1.3.</span> <span class="toc-text">二进制操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%87%E7%94%A8%E7%AE%97%E6%B3%95"><span class="toc-number">5.5.2.</span> <span class="toc-text">采用算法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bool%E5%AD%97%E8%8A%82%E5%AF%B9%E9%BD%90"><span class="toc-number">5.6.</span> <span class="toc-text">Bool 字节对齐</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E7%A9%BA%E7%B1%BB%E5%9E%8B%E6%B3%9B%E5%9E%8B%E6%A8%A1%E6%9D%BF%E9%9C%80%E8%A6%81%E8%BF%94%E5%9B%9E-null-%E5%80%BC%E9%97%AE%E9%A2%98"><span class="toc-number">5.7.</span> <span class="toc-text">可空类型泛型模板需要返回 Null 值问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">6.</span> <span class="toc-text">最后</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2023/01/21/%E4%BD%BF%E7%94%A8WPF%E5%BC%80%E5%8F%91%E6%97%B6%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="bookmark" title="使用WPF开发时问题记录">使用WPF开发时问题记录</a></li><li class="active"><a href="/2023/01/21/%E5%BC%80%E5%8F%91%E4%B8%80%E4%B8%AA%E6%89%B9%E9%87%8F%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7/" rel="bookmark" title="开发一个批量图片处理工具">开发一个批量图片处理工具</a></li><li><a href="/2023/02/05/BatchTextureModifier%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E/" rel="bookmark" title="BatchTextureModifier工具使用说明">BatchTextureModifier工具使用说明</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="WangJiaYing" data-src="/images/../img/avator"><p class="name" itemprop="name">CWHISME</p><div class="description" itemprop="description">己所不欲，勿施于人</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">123</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">22</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">32</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2N3aGlzbWU=" title="https:&#x2F;&#x2F;github.com&#x2F;cwhisme"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9jd2hpc21lLTMzL3Bvc3Rz" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;cwhisme-33&#x2F;posts"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmN3aGlzbWVAMTI2LmNvbQ==" title="mailto:cwhisme@126.com"><i class="ic i-envelope"></i></span> <a href="/atom.xml" title="&#x2F;atom.xml" class="item feedback"><i class="ic i-heart"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/statistics/" rel="section"><i class="ic i-clock"></i>统计</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/01/21/%E4%BD%BF%E7%94%A8WPF%E5%BC%80%E5%8F%91%E6%97%B6%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/01/30/2022%E5%B9%B4%E6%80%BB%E7%BB%93/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Unity3D/" title="分类于 Unity3D">Unity3D</a> <i class="ic i-angle-right"></i> <a href="/categories/Unity3D/%E5%B7%A5%E5%85%B7/" title="分类于 工具">工具</a></div><span><a href="/2016/10/29/%E4%BD%9C%E5%93%81-CryDialogSystem/" title="CryDialogSystem与设计原因">CryDialogSystem与设计原因</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E6%B8%B8%E6%88%8F/" title="分类于 游戏">游戏</a> <i class="ic i-angle-right"></i> <a href="/categories/%E6%B8%B8%E6%88%8F/C/" title="分类于 C#">C#</a></div><span><a href="/2021/12/22/%E8%B7%A8%E8%BF%9B%E7%A8%8B%E8%AF%BB%E5%86%99%E5%86%85%E5%AD%98%E6%95%B0%E6%8D%AE/" title="跨进程读写内存数据">跨进程读写内存数据</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Unity3D/" title="分类于 Unity3D">Unity3D</a> <i class="ic i-angle-right"></i> <a href="/categories/Unity3D/Demo/" title="分类于 Demo">Demo</a></div><span><a href="/2017/02/10/%E4%BD%9C%E5%93%81-Magic-Civilizition/" title="[Demo]Magic Civilizition">[Demo]Magic Civilizition</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment count_3"></ul></div></div><div class="status"><div class="copyright">&copy; 2015 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">WangJiaYing @ Jiaying's Note</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">728k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">11:02</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0NXSElTTUUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/01/21/开发一个批量图片处理工具/",favicon:{show:"（●´3｀●）",hide:"(´Д｀)"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,justifiedGallery:!0,jquery:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script><script src="https://cdn.staticfile.org/pjax/0.2.8/pjax.min.js"></script><script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script><script src="https://cdn.staticfile.org/algoliasearch/4.17.0/algoliasearch-lite.umd.js"></script><script src="https://cdn.staticfile.org/instantsearch.js/4.54.1/instantsearch.production.min.js"></script><script src="https://cdn.staticfile.org/lozad.js/1.16.0/lozad.min.js"></script><script src="https://cdn.staticfile.org/quicklink/2.3.0/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/js/DateTimeAfeterCalc.js" async></script><script src="https://fastly.jsdelivr.net/gh/CWHISME/live2d_api_models@master/autoload.js" async></script><script data-pjax>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?62952472c154f9131a14a4ab57bfefec";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></body></html>